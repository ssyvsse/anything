!function($){var _consts={event:{DRAG:"ztree_drag",DROP:"ztree_drop",RENAME:"ztree_rename",DRAGMOVE:"ztree_dragmove"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},_handler={onHoverOverNode:function(event,node){var setting=data.getSetting(event.data.treeId),root=data.getRoot(setting);root.curHoverNode!=node&&_handler.onHoverOutNode(event),root.curHoverNode=node,view.addHoverDom(setting,node)},onHoverOutNode:function(event,node){var setting=data.getSetting(event.data.treeId),root=data.getRoot(setting);root.curHoverNode&&!data.isSelectedNode(setting,root.curHoverNode)&&(view.removeTreeDom(setting,root.curHoverNode),root.curHoverNode=null)},onMousedownNode:function(eventMouseDown,_node){var i,l,setting=data.getSetting(eventMouseDown.data.treeId),root=data.getRoot(setting),roots=data.getRoots();if(2==eventMouseDown.button||!setting.edit.enable||!setting.edit.drag.isCopy&&!setting.edit.drag.isMove)return!0;var target=eventMouseDown.target,_nodes=data.getRoot(setting).curSelectedList,nodes=[];if(data.isSelectedNode(setting,_node))for(i=0,l=_nodes.length;i<l;i++){if(_nodes[i].editNameFlag&&tools.eqs(target.tagName,"input")&&null!==target.getAttribute("treeNode"+consts.id.INPUT))return!0;if(nodes.push(_nodes[i]),nodes[0].parentTId!==_nodes[i].parentTId){nodes=[_node];break}}else nodes=[_node];view.editNodeBlur=!0,view.cancelCurEditNode(setting);var curNode,tmpArrow,tmpTarget,preNode,nextNode,doc=$(setting.treeObj.get(0).ownerDocument),body=$(setting.treeObj.get(0).ownerDocument.body),isOtherTree=!1,targetSetting=setting,sourceSetting=setting,preTmpTargetNodeId=null,preTmpMoveType=null,tmpTargetNodeId=null,moveType=consts.move.TYPE_INNER,mouseDownX=eventMouseDown.clientX,mouseDownY=eventMouseDown.clientY,startTime=(new Date).getTime();function _docMouseMove(event){if(0==root.dragFlag&&Math.abs(mouseDownX-event.clientX)<setting.edit.drag.minMoveSize&&Math.abs(mouseDownY-event.clientY)<setting.edit.drag.minMoveSize)return!0;var i,l,tmpNode,tmpDom,tmpNodes,childKey=setting.data.key.children;if(body.css("cursor","pointer"),0==root.dragFlag){if(0==tools.apply(setting.callback.beforeDrag,[setting.treeId,nodes],!0))return _docMouseUp(event),!0;for(i=0,l=nodes.length;i<l;i++)0==i&&(root.dragNodeShowBefore=[]),(tmpNode=nodes[i]).isParent&&tmpNode.open?(view.expandCollapseNode(setting,tmpNode,!tmpNode.open),root.dragNodeShowBefore[tmpNode.tId]=!0):root.dragNodeShowBefore[tmpNode.tId]=!1;root.dragFlag=1,roots.showHoverDom=!1,tools.showIfameMask(setting,!0);var isOrder=!0,lastIndex=-1;if(nodes.length>1){var pNodes=nodes[0].parentTId?nodes[0].getParentNode()[childKey]:data.getNodes(setting);for(tmpNodes=[],i=0,l=pNodes.length;i<l;i++)if(void 0!==root.dragNodeShowBefore[pNodes[i].tId]&&(isOrder&&lastIndex>-1&&lastIndex+1!==i&&(isOrder=!1),tmpNodes.push(pNodes[i]),lastIndex=i),nodes.length===tmpNodes.length){nodes=tmpNodes;break}}for(isOrder&&(preNode=nodes[0].getPreNode(),nextNode=nodes[nodes.length-1].getNextNode()),curNode=$$("<ul class='zTreeDragUL'></ul>",setting),i=0,l=nodes.length;i<l;i++)(tmpNode=nodes[i]).editNameFlag=!1,view.selectNode(setting,tmpNode,i>0),view.removeTreeDom(setting,tmpNode),i>setting.edit.drag.maxShowNodeNum-1||((tmpDom=$$("<li id='"+tmpNode.tId+"_tmp'></li>",setting)).append($$(tmpNode,consts.id.A,setting).clone()),tmpDom.css("padding","0"),tmpDom.children("#"+tmpNode.tId+consts.id.A).removeClass(consts.node.CURSELECTED),curNode.append(tmpDom),i==setting.edit.drag.maxShowNodeNum-1&&(tmpDom=$$("<li id='"+tmpNode.tId+"_moretmp'><a>  ...  </a></li>",setting),curNode.append(tmpDom)));curNode.attr("id",nodes[0].tId+consts.id.UL+"_tmp"),curNode.addClass(setting.treeObj.attr("class")),curNode.appendTo(body),(tmpArrow=$$("<span class='tmpzTreeMove_arrow'></span>",setting)).attr("id","zTreeMove_arrow_tmp"),tmpArrow.appendTo(body),setting.treeObj.trigger(consts.event.DRAG,[event,setting.treeId,nodes])}if(1==root.dragFlag){if(tmpTarget&&tmpArrow.attr("id")==event.target.id&&tmpTargetNodeId&&event.clientX+doc.scrollLeft()+2>$("#"+tmpTargetNodeId+consts.id.A,tmpTarget).offset().left){var xT=$("#"+tmpTargetNodeId+consts.id.A,tmpTarget);event.target=xT.length>0?xT.get(0):event.target}else tmpTarget&&(tmpTarget.removeClass(consts.node.TMPTARGET_TREE),tmpTargetNodeId&&$("#"+tmpTargetNodeId+consts.id.A,tmpTarget).removeClass(consts.node.TMPTARGET_NODE+"_"+consts.move.TYPE_PREV).removeClass(consts.node.TMPTARGET_NODE+"_"+_consts.move.TYPE_NEXT).removeClass(consts.node.TMPTARGET_NODE+"_"+_consts.move.TYPE_INNER));tmpTarget=null,tmpTargetNodeId=null,isOtherTree=!1,targetSetting=setting;var settings=data.getSettings();for(var s in settings)settings[s].treeId&&settings[s].edit.enable&&settings[s].treeId!=setting.treeId&&(event.target.id==settings[s].treeId||$(event.target).parents("#"+settings[s].treeId).length>0)&&(isOtherTree=!0,targetSetting=settings[s]);var docScrollTop=doc.scrollTop(),docScrollLeft=doc.scrollLeft(),treeOffset=targetSetting.treeObj.offset(),scrollHeight=targetSetting.treeObj.get(0).scrollHeight,scrollWidth=targetSetting.treeObj.get(0).scrollWidth,dTop=event.clientY+docScrollTop-treeOffset.top,dBottom=targetSetting.treeObj.height()+treeOffset.top-event.clientY-docScrollTop,dLeft=event.clientX+docScrollLeft-treeOffset.left,dRight=targetSetting.treeObj.width()+treeOffset.left-event.clientX-docScrollLeft,isTop=dTop<setting.edit.drag.borderMax&&dTop>setting.edit.drag.borderMin,isBottom=dBottom<setting.edit.drag.borderMax&&dBottom>setting.edit.drag.borderMin,isLeft=dLeft<setting.edit.drag.borderMax&&dLeft>setting.edit.drag.borderMin,isRight=dRight<setting.edit.drag.borderMax&&dRight>setting.edit.drag.borderMin,isTreeInner=dTop>setting.edit.drag.borderMin&&dBottom>setting.edit.drag.borderMin&&dLeft>setting.edit.drag.borderMin&&dRight>setting.edit.drag.borderMin,isTreeTop=isTop&&targetSetting.treeObj.scrollTop()<=0,isTreeBottom=isBottom&&targetSetting.treeObj.scrollTop()+targetSetting.treeObj.height()+10>=scrollHeight,isTreeLeft=isLeft&&targetSetting.treeObj.scrollLeft()<=0,isTreeRight=isRight&&targetSetting.treeObj.scrollLeft()+targetSetting.treeObj.width()+10>=scrollWidth;if(event.target&&tools.isChildOrSelf(event.target,targetSetting.treeId)){for(var targetObj=event.target;targetObj&&targetObj.tagName&&!tools.eqs(targetObj.tagName,"li")&&targetObj.id!=targetSetting.treeId;)targetObj=targetObj.parentNode;var canMove=!0;for(i=0,l=nodes.length;i<l;i++){if(tmpNode=nodes[i],targetObj.id===tmpNode.tId){canMove=!1;break}if($$(tmpNode,setting).find("#"+targetObj.id).length>0){canMove=!1;break}}canMove&&event.target&&tools.isChildOrSelf(event.target,targetObj.id+consts.id.A)&&(tmpTarget=$(targetObj),tmpTargetNodeId=targetObj.id)}tmpNode=nodes[0],isTreeInner&&tools.isChildOrSelf(event.target,targetSetting.treeId)&&(!tmpTarget&&(event.target.id==targetSetting.treeId||isTreeTop||isTreeBottom||isTreeLeft||isTreeRight)&&(isOtherTree||!isOtherTree&&tmpNode.parentTId)&&(tmpTarget=targetSetting.treeObj),isTop?targetSetting.treeObj.scrollTop(targetSetting.treeObj.scrollTop()-10):isBottom&&targetSetting.treeObj.scrollTop(targetSetting.treeObj.scrollTop()+10),isLeft?targetSetting.treeObj.scrollLeft(targetSetting.treeObj.scrollLeft()-10):isRight&&targetSetting.treeObj.scrollLeft(targetSetting.treeObj.scrollLeft()+10),tmpTarget&&tmpTarget!=targetSetting.treeObj&&tmpTarget.offset().left<targetSetting.treeObj.offset().left&&targetSetting.treeObj.scrollLeft(targetSetting.treeObj.scrollLeft()+tmpTarget.offset().left-targetSetting.treeObj.offset().left)),curNode.css({top:event.clientY+docScrollTop+3+"px",left:event.clientX+docScrollLeft+3+"px"});var dX=0,dY=0;if(tmpTarget&&tmpTarget.attr("id")!=targetSetting.treeId){var tmpTargetNode=null==tmpTargetNodeId?null:data.getNodeCache(targetSetting,tmpTargetNodeId),isCopy=(event.ctrlKey||event.metaKey)&&setting.edit.drag.isMove&&setting.edit.drag.isCopy||!setting.edit.drag.isMove&&setting.edit.drag.isCopy,isPrev=!(!preNode||tmpTargetNodeId!==preNode.tId),isNext=!(!nextNode||tmpTargetNodeId!==nextNode.tId),isInner=tmpNode.parentTId&&tmpNode.parentTId==tmpTargetNodeId,canPrev=(isCopy||!isNext)&&tools.apply(targetSetting.edit.drag.prev,[targetSetting.treeId,nodes,tmpTargetNode],!!targetSetting.edit.drag.prev),canNext=(isCopy||!isPrev)&&tools.apply(targetSetting.edit.drag.next,[targetSetting.treeId,nodes,tmpTargetNode],!!targetSetting.edit.drag.next),canInner=(isCopy||!isInner)&&!(targetSetting.data.keep.leaf&&!tmpTargetNode.isParent)&&tools.apply(targetSetting.edit.drag.inner,[targetSetting.treeId,nodes,tmpTargetNode],!!targetSetting.edit.drag.inner);function clearMove(){tmpTarget=null,tmpTargetNodeId="",moveType=consts.move.TYPE_INNER,tmpArrow.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null)}if(canPrev||canNext||canInner){var tmpTargetA=$("#"+tmpTargetNodeId+consts.id.A,tmpTarget),tmpNextA=tmpTargetNode.isLastNode?null:$("#"+tmpTargetNode.getNextNode().tId+consts.id.A,tmpTarget.next()),tmpTop=tmpTargetA.offset().top,tmpLeft=tmpTargetA.offset().left,prevPercent=canPrev?canInner?.25:canNext?.5:1:-1,nextPercent=canNext?canInner?.75:canPrev?.5:0:-1,dY_percent=(event.clientY+docScrollTop-tmpTop)/tmpTargetA.height();if((1==prevPercent||dY_percent<=prevPercent&&dY_percent>=-.2)&&canPrev?(dX=1-tmpArrow.width(),dY=tmpTop-tmpArrow.height()/2,moveType=consts.move.TYPE_PREV):(0==nextPercent||dY_percent>=nextPercent&&dY_percent<=1.2)&&canNext?(dX=1-tmpArrow.width(),dY=null==tmpNextA||tmpTargetNode.isParent&&tmpTargetNode.open?tmpTop+tmpTargetA.height()-tmpArrow.height()/2:tmpNextA.offset().top-tmpArrow.height()/2,moveType=consts.move.TYPE_NEXT):canInner?(dX=5-tmpArrow.width(),dY=tmpTop,moveType=consts.move.TYPE_INNER):clearMove(),tmpTarget&&(tmpArrow.css({display:"block",top:dY+"px",left:tmpLeft+dX+"px"}),tmpTargetA.addClass(consts.node.TMPTARGET_NODE+"_"+moveType),preTmpTargetNodeId==tmpTargetNodeId&&preTmpMoveType==moveType||(startTime=(new Date).getTime()),tmpTargetNode&&tmpTargetNode.isParent&&moveType==consts.move.TYPE_INNER)){var startTimer=!0;window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==tmpTargetNode.tId?(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null):window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===tmpTargetNode.tId&&(startTimer=!1),startTimer&&(window.zTreeMoveTimer=setTimeout(function(){moveType==consts.move.TYPE_INNER&&tmpTargetNode&&tmpTargetNode.isParent&&!tmpTargetNode.open&&(new Date).getTime()-startTime>targetSetting.edit.drag.autoOpenTime&&tools.apply(targetSetting.callback.beforeDragOpen,[targetSetting.treeId,tmpTargetNode],!0)&&(view.switchNode(targetSetting,tmpTargetNode),targetSetting.edit.drag.autoExpandTrigger&&targetSetting.treeObj.trigger(consts.event.EXPAND,[targetSetting.treeId,tmpTargetNode]))},targetSetting.edit.drag.autoOpenTime+50),window.zTreeMoveTargetNodeTId=tmpTargetNode.tId)}}else clearMove()}else moveType=consts.move.TYPE_INNER,tmpTarget&&tools.apply(targetSetting.edit.drag.inner,[targetSetting.treeId,nodes,null],!!targetSetting.edit.drag.inner)?tmpTarget.addClass(consts.node.TMPTARGET_TREE):tmpTarget=null,tmpArrow.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null);preTmpTargetNodeId=tmpTargetNodeId,preTmpMoveType=moveType,setting.treeObj.trigger(consts.event.DRAGMOVE,[event,setting.treeId,nodes])}return!1}function _docMouseUp(event){if(window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null),preTmpTargetNodeId=null,preTmpMoveType=null,doc.unbind("mousemove",_docMouseMove),doc.unbind("mouseup",_docMouseUp),doc.unbind("selectstart",_docSelect),body.css("cursor","auto"),tmpTarget&&(tmpTarget.removeClass(consts.node.TMPTARGET_TREE),tmpTargetNodeId&&$("#"+tmpTargetNodeId+consts.id.A,tmpTarget).removeClass(consts.node.TMPTARGET_NODE+"_"+consts.move.TYPE_PREV).removeClass(consts.node.TMPTARGET_NODE+"_"+_consts.move.TYPE_NEXT).removeClass(consts.node.TMPTARGET_NODE+"_"+_consts.move.TYPE_INNER)),tools.showIfameMask(setting,!1),roots.showHoverDom=!0,0!=root.dragFlag){var i,l,tmpNode;for(root.dragFlag=0,i=0,l=nodes.length;i<l;i++)(tmpNode=nodes[i]).isParent&&root.dragNodeShowBefore[tmpNode.tId]&&!tmpNode.open&&(view.expandCollapseNode(setting,tmpNode,!tmpNode.open),delete root.dragNodeShowBefore[tmpNode.tId]);curNode&&curNode.remove(),tmpArrow&&tmpArrow.remove();var isCopy=(event.ctrlKey||event.metaKey)&&setting.edit.drag.isMove&&setting.edit.drag.isCopy||!setting.edit.drag.isMove&&setting.edit.drag.isCopy;if(!isCopy&&tmpTarget&&tmpTargetNodeId&&nodes[0].parentTId&&tmpTargetNodeId==nodes[0].parentTId&&moveType==consts.move.TYPE_INNER&&(tmpTarget=null),tmpTarget){var dragTargetNode=null==tmpTargetNodeId?null:data.getNodeCache(targetSetting,tmpTargetNodeId);if(0==tools.apply(setting.callback.beforeDrop,[targetSetting.treeId,nodes,dragTargetNode,moveType,isCopy],!0))return void view.selectNodes(sourceSetting,nodes);var newNodes=isCopy?tools.clone(nodes):nodes;function dropCallback(){if(isOtherTree){if(!isCopy)for(var i=0,l=nodes.length;i<l;i++)view.removeNode(setting,nodes[i]);moveType==consts.move.TYPE_INNER?view.addNodes(targetSetting,dragTargetNode,-1,newNodes):view.addNodes(targetSetting,dragTargetNode.getParentNode(),moveType==consts.move.TYPE_PREV?dragTargetNode.getIndex():dragTargetNode.getIndex()+1,newNodes)}else if(isCopy&&moveType==consts.move.TYPE_INNER)view.addNodes(targetSetting,dragTargetNode,-1,newNodes);else if(isCopy)view.addNodes(targetSetting,dragTargetNode.getParentNode(),moveType==consts.move.TYPE_PREV?dragTargetNode.getIndex():dragTargetNode.getIndex()+1,newNodes);else if(moveType!=consts.move.TYPE_NEXT)for(i=0,l=newNodes.length;i<l;i++)view.moveNode(targetSetting,dragTargetNode,newNodes[i],moveType,!1);else for(i=-1,l=newNodes.length-1;i<l;l--)view.moveNode(targetSetting,dragTargetNode,newNodes[l],moveType,!1);view.selectNodes(targetSetting,newNodes);var a=$$(newNodes[0],setting).get(0);view.scrollIntoView(a),setting.treeObj.trigger(consts.event.DROP,[event,targetSetting.treeId,newNodes,dragTargetNode,moveType,isCopy])}moveType==consts.move.TYPE_INNER&&tools.canAsync(targetSetting,dragTargetNode)?view.asyncNode(targetSetting,dragTargetNode,!1,dropCallback):dropCallback()}else view.selectNodes(sourceSetting,nodes),setting.treeObj.trigger(consts.event.DROP,[event,setting.treeId,nodes,null,null,null])}}function _docSelect(){return!1}return tools.uCanDo(setting)&&doc.bind("mousemove",_docMouseMove),doc.bind("mouseup",_docMouseUp),doc.bind("selectstart",_docSelect),eventMouseDown.preventDefault&&eventMouseDown.preventDefault(),!0}},_z={tools:{getAbs:function(obj){var oRect=obj.getBoundingClientRect(),scrollTop=document.body.scrollTop+document.documentElement.scrollTop,scrollLeft=document.body.scrollLeft+document.documentElement.scrollLeft;return[oRect.left+scrollLeft,oRect.top+scrollTop]},inputFocus:function(inputObj){inputObj.get(0)&&(inputObj.focus(),tools.setCursorPosition(inputObj.get(0),inputObj.val().length))},inputSelect:function(inputObj){inputObj.get(0)&&(inputObj.focus(),inputObj.select())},setCursorPosition:function(obj,pos){if(obj.setSelectionRange)obj.focus(),obj.setSelectionRange(pos,pos);else if(obj.createTextRange){var range=obj.createTextRange();range.collapse(!0),range.moveEnd("character",pos),range.moveStart("character",pos),range.select()}},showIfameMask:function(setting,showSign){for(var root=data.getRoot(setting);root.dragMaskList.length>0;)root.dragMaskList[0].remove(),root.dragMaskList.shift();if(showSign)for(var iframeList=$$("iframe",setting),i=0,l=iframeList.length;i<l;i++){var obj=iframeList.get(i),r=tools.getAbs(obj),dragMask=$$("<div id='zTreeMask_"+i+"' class='zTreeMask' style='top:"+r[1]+"px; left:"+r[0]+"px; width:"+obj.offsetWidth+"px; height:"+obj.offsetHeight+"px;'></div>",setting);dragMask.appendTo($$("body",setting)),root.dragMaskList.push(dragMask)}}},view:{addEditBtn:function(setting,node){if(!(node.editNameFlag||$$(node,consts.id.EDIT,setting).length>0)&&tools.apply(setting.edit.showRenameBtn,[setting.treeId,node],setting.edit.showRenameBtn)){var aObj=$$(node,consts.id.A,setting),editStr="<span class='"+consts.className.BUTTON+" edit' id='"+node.tId+consts.id.EDIT+"' title='"+tools.apply(setting.edit.renameTitle,[setting.treeId,node],setting.edit.renameTitle)+"' treeNode"+consts.id.EDIT+" style='display:none;'></span>";aObj.append(editStr),$$(node,consts.id.EDIT,setting).bind("click",function(){return!(!tools.uCanDo(setting)||0==tools.apply(setting.callback.beforeEditName,[setting.treeId,node],!0))&&(view.editNode(setting,node),!1)}).show()}},addRemoveBtn:function(setting,node){if(!(node.editNameFlag||$$(node,consts.id.REMOVE,setting).length>0)&&tools.apply(setting.edit.showRemoveBtn,[setting.treeId,node],setting.edit.showRemoveBtn)){var aObj=$$(node,consts.id.A,setting),removeStr="<span class='"+consts.className.BUTTON+" remove' id='"+node.tId+consts.id.REMOVE+"' title='"+tools.apply(setting.edit.removeTitle,[setting.treeId,node],setting.edit.removeTitle)+"' treeNode"+consts.id.REMOVE+" style='display:none;'></span>";aObj.append(removeStr),$$(node,consts.id.REMOVE,setting).bind("click",function(){return!(!tools.uCanDo(setting)||0==tools.apply(setting.callback.beforeRemove,[setting.treeId,node],!0))&&(view.removeNode(setting,node),setting.treeObj.trigger(consts.event.REMOVE,[setting.treeId,node]),!1)}).bind("mousedown",function(eventMouseDown){return!0}).show()}},addHoverDom:function(setting,node){data.getRoots().showHoverDom&&(node.isHover=!0,setting.edit.enable&&(view.addEditBtn(setting,node),view.addRemoveBtn(setting,node)),tools.apply(setting.view.addHoverDom,[setting.treeId,node]))},cancelCurEditNode:function(setting,forceName,isCancel){var root=data.getRoot(setting),nameKey=setting.data.key.name,node=root.curEditNode;if(node){var inputObj=root.curEditInput,newName=forceName||(isCancel?node[nameKey]:inputObj.val());if(!1===tools.apply(setting.callback.beforeRename,[setting.treeId,node,newName,isCancel],!0))return!1;node[nameKey]=newName,$$(node,consts.id.A,setting).removeClass(consts.node.CURSELECTED_EDIT),inputObj.unbind(),view.setNodeName(setting,node),node.editNameFlag=!1,root.curEditNode=null,root.curEditInput=null,view.selectNode(setting,node,!1),setting.treeObj.trigger(consts.event.RENAME,[setting.treeId,node,isCancel])}return root.noSelection=!0,!0},editNode:function(setting,node){var root=data.getRoot(setting);if(view.editNodeBlur=!1,data.isSelectedNode(setting,node)&&root.curEditNode==node&&node.editNameFlag)setTimeout(function(){tools.inputFocus(root.curEditInput)},0);else{var nameKey=setting.data.key.name;node.editNameFlag=!0,view.removeTreeDom(setting,node),view.cancelCurEditNode(setting),view.selectNode(setting,node,!1),$$(node,consts.id.SPAN,setting).html("<input type=text class='rename' id='"+node.tId+consts.id.INPUT+"' treeNode"+consts.id.INPUT+" >");var inputObj=$$(node,consts.id.INPUT,setting);inputObj.attr("value",node[nameKey]),setting.edit.editNameSelectAll?tools.inputSelect(inputObj):tools.inputFocus(inputObj),inputObj.bind("blur",function(event){view.editNodeBlur||view.cancelCurEditNode(setting)}).bind("keydown",function(event){"13"==event.keyCode?(view.editNodeBlur=!0,view.cancelCurEditNode(setting)):"27"==event.keyCode&&view.cancelCurEditNode(setting,null,!0)}).bind("click",function(event){return!1}).bind("dblclick",function(event){return!1}),$$(node,consts.id.A,setting).addClass(consts.node.CURSELECTED_EDIT),root.curEditInput=inputObj,root.noSelection=!1,root.curEditNode=node}},moveNode:function(setting,targetNode,node,moveType,animateFlag,isSilent){var root=data.getRoot(setting),childKey=setting.data.key.children;if(targetNode!=node&&(!setting.data.keep.leaf||!targetNode||targetNode.isParent||moveType!=consts.move.TYPE_INNER)){var oldParentNode=node.parentTId?node.getParentNode():root,targetNodeIsRoot=null===targetNode||targetNode==root;targetNodeIsRoot&&null===targetNode&&(targetNode=root),targetNodeIsRoot&&(moveType=consts.move.TYPE_INNER);var targetObj,target_ulObj,targetParentNode=targetNode.parentTId?targetNode.getParentNode():root;if(moveType!=consts.move.TYPE_PREV&&moveType!=consts.move.TYPE_NEXT&&(moveType=consts.move.TYPE_INNER),moveType==consts.move.TYPE_INNER&&(targetNodeIsRoot?node.parentTId=null:(targetNode.isParent||(targetNode.isParent=!0,targetNode.open=!!targetNode.open,view.setNodeLineIcos(setting,targetNode)),node.parentTId=targetNode.tId)),targetNodeIsRoot)target_ulObj=targetObj=setting.treeObj;else{if(isSilent||moveType!=consts.move.TYPE_INNER?isSilent||view.expandCollapseNode(setting,targetNode.getParentNode(),!0,!1):view.expandCollapseNode(setting,targetNode,!0,!1),targetObj=$$(targetNode,setting),target_ulObj=$$(targetNode,consts.id.UL,setting),targetObj.get(0)&&!target_ulObj.get(0)){var ulstr=[];view.makeUlHtml(setting,targetNode,ulstr,""),targetObj.append(ulstr.join(""))}target_ulObj=$$(targetNode,consts.id.UL,setting)}var nodeDom=$$(node,setting);nodeDom.get(0)?targetObj.get(0)||nodeDom.remove():nodeDom=view.appendNodes(setting,node.level,[node],null,-1,!1,!0).join(""),target_ulObj.get(0)&&moveType==consts.move.TYPE_INNER?target_ulObj.append(nodeDom):targetObj.get(0)&&moveType==consts.move.TYPE_PREV?targetObj.before(nodeDom):targetObj.get(0)&&moveType==consts.move.TYPE_NEXT&&targetObj.after(nodeDom);var i,l,tmpSrcIndex=-1,tmpTargetIndex=0,oldNeighbor=null,newNeighbor=null,oldLevel=node.level;if(node.isFirstNode)tmpSrcIndex=0,oldParentNode[childKey].length>1&&((oldNeighbor=oldParentNode[childKey][1]).isFirstNode=!0);else if(node.isLastNode)tmpSrcIndex=oldParentNode[childKey].length-1,(oldNeighbor=oldParentNode[childKey][tmpSrcIndex-1]).isLastNode=!0;else for(i=0,l=oldParentNode[childKey].length;i<l;i++)if(oldParentNode[childKey][i].tId==node.tId){tmpSrcIndex=i;break}if(tmpSrcIndex>=0&&oldParentNode[childKey].splice(tmpSrcIndex,1),moveType!=consts.move.TYPE_INNER)for(i=0,l=targetParentNode[childKey].length;i<l;i++)targetParentNode[childKey][i].tId==targetNode.tId&&(tmpTargetIndex=i);if(moveType==consts.move.TYPE_INNER?(targetNode[childKey]||(targetNode[childKey]=new Array),targetNode[childKey].length>0&&((newNeighbor=targetNode[childKey][targetNode[childKey].length-1]).isLastNode=!1),targetNode[childKey].splice(targetNode[childKey].length,0,node),node.isLastNode=!0,node.isFirstNode=1==targetNode[childKey].length):targetNode.isFirstNode&&moveType==consts.move.TYPE_PREV?(targetParentNode[childKey].splice(tmpTargetIndex,0,node),(newNeighbor=targetNode).isFirstNode=!1,node.parentTId=targetNode.parentTId,node.isFirstNode=!0,node.isLastNode=!1):targetNode.isLastNode&&moveType==consts.move.TYPE_NEXT?(targetParentNode[childKey].splice(tmpTargetIndex+1,0,node),(newNeighbor=targetNode).isLastNode=!1,node.parentTId=targetNode.parentTId,node.isFirstNode=!1,node.isLastNode=!0):(moveType==consts.move.TYPE_PREV?targetParentNode[childKey].splice(tmpTargetIndex,0,node):targetParentNode[childKey].splice(tmpTargetIndex+1,0,node),node.parentTId=targetNode.parentTId,node.isFirstNode=!1,node.isLastNode=!1),data.fixPIdKeyValue(setting,node),data.setSonNodeLevel(setting,node.getParentNode(),node),view.setNodeLineIcos(setting,node),view.repairNodeLevelClass(setting,node,oldLevel),!setting.data.keep.parent&&oldParentNode[childKey].length<1){oldParentNode.isParent=!1,oldParentNode.open=!1;var tmp_ulObj=$$(oldParentNode,consts.id.UL,setting),tmp_switchObj=$$(oldParentNode,consts.id.SWITCH,setting),tmp_icoObj=$$(oldParentNode,consts.id.ICON,setting);view.replaceSwitchClass(oldParentNode,tmp_switchObj,consts.folder.DOCU),view.replaceIcoClass(oldParentNode,tmp_icoObj,consts.folder.DOCU),tmp_ulObj.css("display","none")}else oldNeighbor&&view.setNodeLineIcos(setting,oldNeighbor);newNeighbor&&view.setNodeLineIcos(setting,newNeighbor),setting.check&&setting.check.enable&&view.repairChkClass&&(view.repairChkClass(setting,oldParentNode),view.repairParentChkClassWithSelf(setting,oldParentNode),oldParentNode!=node.parent&&view.repairParentChkClassWithSelf(setting,node)),isSilent||view.expandCollapseParentNode(setting,node.getParentNode(),!0,animateFlag)}},removeEditBtn:function(setting,node){$$(node,consts.id.EDIT,setting).unbind().remove()},removeRemoveBtn:function(setting,node){$$(node,consts.id.REMOVE,setting).unbind().remove()},removeTreeDom:function(setting,node){node.isHover=!1,view.removeEditBtn(setting,node),view.removeRemoveBtn(setting,node),tools.apply(setting.view.removeHoverDom,[setting.treeId,node])},repairNodeLevelClass:function(setting,node,oldLevel){if(oldLevel!==node.level){var liObj=$$(node,setting),aObj=$$(node,consts.id.A,setting),ulObj=$$(node,consts.id.UL,setting),oldClass=consts.className.LEVEL+oldLevel,newClass=consts.className.LEVEL+node.level;liObj.removeClass(oldClass),liObj.addClass(newClass),aObj.removeClass(oldClass),aObj.addClass(newClass),ulObj.removeClass(oldClass),ulObj.addClass(newClass)}},selectNodes:function(setting,nodes){for(var i=0,l=nodes.length;i<l;i++)view.selectNode(setting,nodes[i],i>0)}},event:{},data:{setSonNodeLevel:function(setting,parentNode,node){if(node){var childKey=setting.data.key.children;if(node.level=parentNode?parentNode.level+1:0,node[childKey])for(var i=0,l=node[childKey].length;i<l;i++)node[childKey][i]&&data.setSonNodeLevel(setting,node,node[childKey][i])}}}};$.extend(!0,$.fn.zTree.consts,_consts),$.extend(!0,$.fn.zTree._z,_z);var zt=$.fn.zTree,tools=zt._z.tools,consts=zt.consts,view=zt._z.view,data=zt._z.data,$$=(zt._z.event,tools.$);data.exSetting({edit:{enable:!1,editNameSelectAll:!1,showRemoveBtn:!0,showRenameBtn:!0,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:!1,isCopy:!0,isMove:!0,prev:!0,next:!0,inner:!0,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDragMove:null,onDrop:null,onRename:null}}),data.addInitBind(function(setting){var o=setting.treeObj,c=consts.event;o.bind(c.RENAME,function(event,treeId,treeNode,isCancel){tools.apply(setting.callback.onRename,[event,treeId,treeNode,isCancel])}),o.bind(c.DRAG,function(event,srcEvent,treeId,treeNodes){tools.apply(setting.callback.onDrag,[srcEvent,treeId,treeNodes])}),o.bind(c.DRAGMOVE,function(event,srcEvent,treeId,treeNodes){tools.apply(setting.callback.onDragMove,[srcEvent,treeId,treeNodes])}),o.bind(c.DROP,function(event,srcEvent,treeId,treeNodes,targetNode,moveType,isCopy){tools.apply(setting.callback.onDrop,[srcEvent,treeId,treeNodes,targetNode,moveType,isCopy])})}),data.addInitUnBind(function(setting){var o=setting.treeObj,c=consts.event;o.unbind(c.RENAME),o.unbind(c.DRAG),o.unbind(c.DRAGMOVE),o.unbind(c.DROP)}),data.addInitCache(function(treeId){}),data.addInitNode(function(setting,level,n,parentNode,isFirstNode,isLastNode,openFlag){n&&(n.isHover=!1,n.editNameFlag=!1)}),data.addInitProxy(function(e){var target=e.target,setting=data.getSetting(e.data.treeId),relatedTarget=e.relatedTarget,tId="",node=null,nodeEventType="",nodeEventCallback=null,tmp=null;if(tools.eqs(e.type,"mouseover")?(tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]))&&(tId=tools.getNodeMainDom(tmp).id,nodeEventType="hoverOverNode"):tools.eqs(e.type,"mouseout")?(tmp=tools.getMDom(setting,relatedTarget,[{tagName:"a",attrName:"treeNode"+consts.id.A}]))||(tId="remove",nodeEventType="hoverOutNode"):tools.eqs(e.type,"mousedown")&&(tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]))&&(tId=tools.getNodeMainDom(tmp).id,nodeEventType="mousedownNode"),tId.length>0)switch(node=data.getNodeCache(setting,tId),nodeEventType){case"mousedownNode":nodeEventCallback=_handler.onMousedownNode;break;case"hoverOverNode":nodeEventCallback=_handler.onHoverOverNode;break;case"hoverOutNode":nodeEventCallback=_handler.onHoverOutNode}return{stop:!1,node:node,nodeEventType:nodeEventType,nodeEventCallback:nodeEventCallback,treeEventType:"",treeEventCallback:null}}),data.addInitRoot(function(setting){var r=data.getRoot(setting),rs=data.getRoots();r.curEditNode=null,r.curEditInput=null,r.curHoverNode=null,r.dragFlag=0,r.dragNodeShowBefore=[],r.dragMaskList=new Array,rs.showHoverDom=!0}),data.addZTreeTools(function(setting,zTreeTools){zTreeTools.cancelEditName=function(newName){data.getRoot(this.setting).curEditNode&&view.cancelCurEditNode(this.setting,newName||null,!0)},zTreeTools.copyNode=function(targetNode,node,moveType,isSilent){if(!node)return null;if(targetNode&&!targetNode.isParent&&this.setting.data.keep.leaf&&moveType===consts.move.TYPE_INNER)return null;var _this=this,newNode=tools.clone(node);if(targetNode||(targetNode=null,moveType=consts.move.TYPE_INNER),moveType==consts.move.TYPE_INNER){function copyCallback(){view.addNodes(_this.setting,targetNode,-1,[newNode],isSilent)}tools.canAsync(this.setting,targetNode)?view.asyncNode(this.setting,targetNode,isSilent,copyCallback):copyCallback()}else view.addNodes(this.setting,targetNode.parentNode,-1,[newNode],isSilent),view.moveNode(this.setting,targetNode,newNode,moveType,!1,isSilent);return newNode},zTreeTools.editName=function(node){node&&node.tId&&node===data.getNodeCache(this.setting,node.tId)&&(node.parentTId&&view.expandCollapseParentNode(this.setting,node.getParentNode(),!0),view.editNode(this.setting,node))},zTreeTools.moveNode=function(targetNode,node,moveType,isSilent){if(!node)return node;if(targetNode&&!targetNode.isParent&&this.setting.data.keep.leaf&&moveType===consts.move.TYPE_INNER)return null;if(targetNode&&(node.parentTId==targetNode.tId&&moveType==consts.move.TYPE_INNER||$$(node,this.setting).find("#"+targetNode.tId).length>0))return null;targetNode||(targetNode=null);var _this=this;function moveCallback(){view.moveNode(_this.setting,targetNode,node,moveType,!1,isSilent)}return tools.canAsync(this.setting,targetNode)&&moveType===consts.move.TYPE_INNER?view.asyncNode(this.setting,targetNode,isSilent,moveCallback):moveCallback(),node},zTreeTools.setEditable=function(editable){return this.setting.edit.enable=editable,this.refresh()}});var _cancelPreSelectedNode=view.cancelPreSelectedNode;view.cancelPreSelectedNode=function(setting,node){for(var list=data.getRoot(setting).curSelectedList,i=0,j=list.length;i<j&&(node&&node!==list[i]||(view.removeTreeDom(setting,list[i]),!node));i++);_cancelPreSelectedNode&&_cancelPreSelectedNode.apply(view,arguments)};var _createNodes=view.createNodes;view.createNodes=function(setting,level,nodes,parentNode,index){_createNodes&&_createNodes.apply(view,arguments),nodes&&view.repairParentChkClassWithSelf&&view.repairParentChkClassWithSelf(setting,parentNode)};var _makeNodeUrl=view.makeNodeUrl;view.makeNodeUrl=function(setting,node){return setting.edit.enable?null:_makeNodeUrl.apply(view,arguments)};var _removeNode=view.removeNode;view.removeNode=function(setting,node){var root=data.getRoot(setting);root.curEditNode===node&&(root.curEditNode=null),_removeNode&&_removeNode.apply(view,arguments)};var _selectNode=view.selectNode;view.selectNode=function(setting,node,addFlag){var root=data.getRoot(setting);return(!data.isSelectedNode(setting,node)||root.curEditNode!=node||!node.editNameFlag)&&(_selectNode&&_selectNode.apply(view,arguments),view.addHoverDom(setting,node),!0)};var _uCanDo=tools.uCanDo;tools.uCanDo=function(setting,e){var root=data.getRoot(setting);return!(!e||!(tools.eqs(e.type,"mouseover")||tools.eqs(e.type,"mouseout")||tools.eqs(e.type,"mousedown")||tools.eqs(e.type,"mouseup")))||(root.curEditNode&&(view.editNodeBlur=!1,root.curEditInput.focus()),!root.curEditNode&&(!_uCanDo||_uCanDo.apply(view,arguments)))}}(jQuery);