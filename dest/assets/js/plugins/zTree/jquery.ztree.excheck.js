!function($){var _consts={event:{CHECK:"ztree_check"},id:{CHECK:"_check"},checkbox:{STYLE:"checkbox",DEFAULT:"chk",DISABLED:"disable",FALSE:"false",TRUE:"true",FULL:"full",PART:"part",FOCUS:"focus"},radio:{STYLE:"radio",TYPE_ALL:"all",TYPE_LEVEL:"level"}},_setting={check:{enable:!1,autoCheckTrigger:!1,chkStyle:_consts.checkbox.STYLE,nocheckInherit:!1,chkDisabledInherit:!1,radioType:_consts.radio.TYPE_LEVEL,chkboxType:{Y:"ps",N:"ps"}},data:{key:{checked:"checked"}},callback:{beforeCheck:null,onCheck:null}},_handler={onCheckNode:function(event,node){if(!0===node.chkDisabled)return!1;var setting=data.getSetting(event.data.treeId),checkedKey=setting.data.key.checked;if(0==tools.apply(setting.callback.beforeCheck,[setting.treeId,node],!0))return!0;node[checkedKey]=!node[checkedKey],view.checkNodeRelation(setting,node);var checkObj=$$(node,consts.id.CHECK,setting);return view.setChkClass(setting,checkObj,node),view.repairParentChkClassWithSelf(setting,node),setting.treeObj.trigger(consts.event.CHECK,[event,setting.treeId,node]),!0},onMouseoverCheck:function(event,node){if(!0===node.chkDisabled)return!1;var setting=data.getSetting(event.data.treeId),checkObj=$$(node,consts.id.CHECK,setting);return node.check_Focus=!0,view.setChkClass(setting,checkObj,node),!0},onMouseoutCheck:function(event,node){if(!0===node.chkDisabled)return!1;var setting=data.getSetting(event.data.treeId),checkObj=$$(node,consts.id.CHECK,setting);return node.check_Focus=!1,view.setChkClass(setting,checkObj,node),!0}},_z={tools:{},view:{checkNodeRelation:function(setting,node){var pNode,i,l,childKey=setting.data.key.children,checkedKey=setting.data.key.checked,r=consts.radio;if(setting.check.chkStyle==r.STYLE){var checkedList=data.getRadioCheckedList(setting);if(node[checkedKey])if(setting.check.radioType==r.TYPE_ALL){for(i=checkedList.length-1;i>=0;i--)(pNode=checkedList[i])[checkedKey]&&pNode!=node&&(pNode[checkedKey]=!1,checkedList.splice(i,1),view.setChkClass(setting,$$(pNode,consts.id.CHECK,setting),pNode),pNode.parentTId!=node.parentTId&&view.repairParentChkClassWithSelf(setting,pNode));checkedList.push(node)}else{var parentNode=node.parentTId?node.getParentNode():data.getRoot(setting);for(i=0,l=parentNode[childKey].length;i<l;i++)(pNode=parentNode[childKey][i])[checkedKey]&&pNode!=node&&(pNode[checkedKey]=!1,view.setChkClass(setting,$$(pNode,consts.id.CHECK,setting),pNode))}else if(setting.check.radioType==r.TYPE_ALL)for(i=0,l=checkedList.length;i<l;i++)if(node==checkedList[i]){checkedList.splice(i,1);break}}else node[checkedKey]&&(!node[childKey]||0==node[childKey].length||setting.check.chkboxType.Y.indexOf("s")>-1)&&view.setSonNodeCheckBox(setting,node,!0),node[checkedKey]||node[childKey]&&0!=node[childKey].length&&!(setting.check.chkboxType.N.indexOf("s")>-1)||view.setSonNodeCheckBox(setting,node,!1),node[checkedKey]&&setting.check.chkboxType.Y.indexOf("p")>-1&&view.setParentNodeCheckBox(setting,node,!0),!node[checkedKey]&&setting.check.chkboxType.N.indexOf("p")>-1&&view.setParentNodeCheckBox(setting,node,!1)},makeChkClass:function(setting,node){var checkedKey=setting.data.key.checked,c=consts.checkbox,r=consts.radio,fullStyle="";fullStyle=!0===node.chkDisabled?c.DISABLED:node.halfCheck?c.PART:setting.check.chkStyle==r.STYLE?node.check_Child_State<1?c.FULL:c.PART:node[checkedKey]?2===node.check_Child_State||-1===node.check_Child_State?c.FULL:c.PART:node.check_Child_State<1?c.FULL:c.PART;var chkName=setting.check.chkStyle+"_"+(node[checkedKey]?c.TRUE:c.FALSE)+"_"+fullStyle;return chkName=node.check_Focus&&!0!==node.chkDisabled?chkName+"_"+c.FOCUS:chkName,consts.className.BUTTON+" "+c.DEFAULT+" "+chkName},repairAllChk:function(setting,checked){if(setting.check.enable&&setting.check.chkStyle===consts.checkbox.STYLE)for(var checkedKey=setting.data.key.checked,childKey=setting.data.key.children,root=data.getRoot(setting),i=0,l=root[childKey].length;i<l;i++){var node=root[childKey][i];!0!==node.nocheck&&!0!==node.chkDisabled&&(node[checkedKey]=checked),view.setSonNodeCheckBox(setting,node,checked)}},repairChkClass:function(setting,node){if(node&&(data.makeChkFlag(setting,node),!0!==node.nocheck)){var checkObj=$$(node,consts.id.CHECK,setting);view.setChkClass(setting,checkObj,node)}},repairParentChkClass:function(setting,node){if(node&&node.parentTId){var pNode=node.getParentNode();view.repairChkClass(setting,pNode),view.repairParentChkClass(setting,pNode)}},repairParentChkClassWithSelf:function(setting,node){if(node){var childKey=setting.data.key.children;node[childKey]&&node[childKey].length>0?view.repairParentChkClass(setting,node[childKey][0]):view.repairParentChkClass(setting,node)}},repairSonChkDisabled:function(setting,node,chkDisabled,inherit){if(node){var childKey=setting.data.key.children;if(node.chkDisabled!=chkDisabled&&(node.chkDisabled=chkDisabled),view.repairChkClass(setting,node),node[childKey]&&inherit)for(var i=0,l=node[childKey].length;i<l;i++){var sNode=node[childKey][i];view.repairSonChkDisabled(setting,sNode,chkDisabled,inherit)}}},repairParentChkDisabled:function(setting,node,chkDisabled,inherit){node&&(node.chkDisabled!=chkDisabled&&inherit&&(node.chkDisabled=chkDisabled),view.repairChkClass(setting,node),view.repairParentChkDisabled(setting,node.getParentNode(),chkDisabled,inherit))},setChkClass:function(setting,obj,node){obj&&(!0===node.nocheck?obj.hide():obj.show(),obj.attr("class",view.makeChkClass(setting,node)))},setParentNodeCheckBox:function(setting,node,value,srcNode){var childKey=setting.data.key.children,checkedKey=setting.data.key.checked,checkObj=$$(node,consts.id.CHECK,setting);if(srcNode||(srcNode=node),data.makeChkFlag(setting,node),!0!==node.nocheck&&!0!==node.chkDisabled&&(node[checkedKey]=value,view.setChkClass(setting,checkObj,node),setting.check.autoCheckTrigger&&node!=srcNode&&setting.treeObj.trigger(consts.event.CHECK,[null,setting.treeId,node])),node.parentTId){var pSign=!0;if(!value)for(var pNodes=node.getParentNode()[childKey],i=0,l=pNodes.length;i<l;i++)if(!0!==pNodes[i].nocheck&&!0!==pNodes[i].chkDisabled&&pNodes[i][checkedKey]||(!0===pNodes[i].nocheck||!0===pNodes[i].chkDisabled)&&pNodes[i].check_Child_State>0){pSign=!1;break}pSign&&view.setParentNodeCheckBox(setting,node.getParentNode(),value,srcNode)}},setSonNodeCheckBox:function(setting,node,value,srcNode){if(node){var childKey=setting.data.key.children,checkedKey=setting.data.key.checked,checkObj=$$(node,consts.id.CHECK,setting);srcNode||(srcNode=node);var hasDisable=!1;if(node[childKey])for(var i=0,l=node[childKey].length;i<l;i++){var sNode=node[childKey][i];view.setSonNodeCheckBox(setting,sNode,value,srcNode),!0===sNode.chkDisabled&&(hasDisable=!0)}node!=data.getRoot(setting)&&!0!==node.chkDisabled&&(hasDisable&&!0!==node.nocheck&&data.makeChkFlag(setting,node),!0!==node.nocheck&&!0!==node.chkDisabled?(node[checkedKey]=value,hasDisable||(node.check_Child_State=node[childKey]&&node[childKey].length>0?value?2:0:-1)):node.check_Child_State=-1,view.setChkClass(setting,checkObj,node),setting.check.autoCheckTrigger&&node!=srcNode&&!0!==node.nocheck&&!0!==node.chkDisabled&&setting.treeObj.trigger(consts.event.CHECK,[null,setting.treeId,node]))}}},event:{},data:{getRadioCheckedList:function(setting){for(var checkedList=data.getRoot(setting).radioCheckedList,i=0,j=checkedList.length;i<j;i++)data.getNodeCache(setting,checkedList[i].tId)||(checkedList.splice(i,1),i--,j--);return checkedList},getCheckStatus:function(setting,node){if(!setting.check.enable||node.nocheck||node.chkDisabled)return null;var checkedKey=setting.data.key.checked;return{checked:node[checkedKey],half:node.halfCheck?node.halfCheck:setting.check.chkStyle==consts.radio.STYLE?2===node.check_Child_State:node[checkedKey]?node.check_Child_State>-1&&node.check_Child_State<2:node.check_Child_State>0}},getTreeCheckedNodes:function(setting,nodes,checked,results){if(!nodes)return[];var childKey=setting.data.key.children,checkedKey=setting.data.key.checked,onlyOne=checked&&setting.check.chkStyle==consts.radio.STYLE&&setting.check.radioType==consts.radio.TYPE_ALL;results=results||[];for(var i=0,l=nodes.length;i<l&&(!0===nodes[i].nocheck||!0===nodes[i].chkDisabled||nodes[i][checkedKey]!=checked||(results.push(nodes[i]),!onlyOne))&&(data.getTreeCheckedNodes(setting,nodes[i][childKey],checked,results),!(onlyOne&&results.length>0));i++);return results},getTreeChangeCheckedNodes:function(setting,nodes,results){if(!nodes)return[];var childKey=setting.data.key.children,checkedKey=setting.data.key.checked;results=results||[];for(var i=0,l=nodes.length;i<l;i++)!0!==nodes[i].nocheck&&!0!==nodes[i].chkDisabled&&nodes[i][checkedKey]!=nodes[i].checkedOld&&results.push(nodes[i]),data.getTreeChangeCheckedNodes(setting,nodes[i][childKey],results);return results},makeChkFlag:function(setting,node){if(node){var childKey=setting.data.key.children,checkedKey=setting.data.key.checked,chkFlag=-1;if(node[childKey])for(var i=0,l=node[childKey].length;i<l;i++){var cNode=node[childKey][i],tmp=-1;if(setting.check.chkStyle==consts.radio.STYLE){if(2==(tmp=!0===cNode.nocheck||!0===cNode.chkDisabled?cNode.check_Child_State:!0===cNode.halfCheck?2:cNode[checkedKey]?2:cNode.check_Child_State>0?2:0)){chkFlag=2;break}0==tmp&&(chkFlag=0)}else if(setting.check.chkStyle==consts.checkbox.STYLE){if(1===(tmp=!0===cNode.nocheck||!0===cNode.chkDisabled?cNode.check_Child_State:!0===cNode.halfCheck?1:cNode[checkedKey]?-1===cNode.check_Child_State||2===cNode.check_Child_State?2:1:cNode.check_Child_State>0?1:0)){chkFlag=1;break}if(2===tmp&&chkFlag>-1&&i>0&&tmp!==chkFlag){chkFlag=1;break}if(2===chkFlag&&tmp>-1&&tmp<2){chkFlag=1;break}tmp>-1&&(chkFlag=tmp)}}node.check_Child_State=chkFlag}}}};$.extend(!0,$.fn.zTree.consts,_consts),$.extend(!0,$.fn.zTree._z,_z);var zt=$.fn.zTree,tools=zt._z.tools,consts=zt.consts,view=zt._z.view,data=zt._z.data,$$=(zt._z.event,tools.$);data.exSetting(_setting),data.addInitBind(function(setting){var o=setting.treeObj,c=consts.event;o.bind(c.CHECK,function(event,srcEvent,treeId,node){event.srcEvent=srcEvent,tools.apply(setting.callback.onCheck,[event,treeId,node])})}),data.addInitUnBind(function(setting){var o=setting.treeObj,c=consts.event;o.unbind(c.CHECK)}),data.addInitCache(function(treeId){}),data.addInitNode(function(setting,level,n,parentNode,isFirstNode,isLastNode,openFlag){if(n){var checkedKey=setting.data.key.checked;"string"==typeof n[checkedKey]&&(n[checkedKey]=tools.eqs(n[checkedKey],"true")),n[checkedKey]=!!n[checkedKey],n.checkedOld=n[checkedKey],"string"==typeof n.nocheck&&(n.nocheck=tools.eqs(n.nocheck,"true")),n.nocheck=!!n.nocheck||setting.check.nocheckInherit&&parentNode&&!!parentNode.nocheck,"string"==typeof n.chkDisabled&&(n.chkDisabled=tools.eqs(n.chkDisabled,"true")),n.chkDisabled=!!n.chkDisabled||setting.check.chkDisabledInherit&&parentNode&&!!parentNode.chkDisabled,"string"==typeof n.halfCheck&&(n.halfCheck=tools.eqs(n.halfCheck,"true")),n.halfCheck=!!n.halfCheck,n.check_Child_State=-1,n.check_Focus=!1,n.getCheckStatus=function(){return data.getCheckStatus(setting,n)},setting.check.chkStyle==consts.radio.STYLE&&setting.check.radioType==consts.radio.TYPE_ALL&&n[checkedKey]&&data.getRoot(setting).radioCheckedList.push(n)}}),data.addInitProxy(function(e){var target=e.target,setting=data.getSetting(e.data.treeId),tId="",node=null,nodeEventType="",nodeEventCallback=null;if(tools.eqs(e.type,"mouseover")?setting.check.enable&&tools.eqs(target.tagName,"span")&&null!==target.getAttribute("treeNode"+consts.id.CHECK)&&(tId=tools.getNodeMainDom(target).id,nodeEventType="mouseoverCheck"):tools.eqs(e.type,"mouseout")?setting.check.enable&&tools.eqs(target.tagName,"span")&&null!==target.getAttribute("treeNode"+consts.id.CHECK)&&(tId=tools.getNodeMainDom(target).id,nodeEventType="mouseoutCheck"):tools.eqs(e.type,"click")&&setting.check.enable&&tools.eqs(target.tagName,"span")&&null!==target.getAttribute("treeNode"+consts.id.CHECK)&&(tId=tools.getNodeMainDom(target).id,nodeEventType="checkNode"),tId.length>0)switch(node=data.getNodeCache(setting,tId),nodeEventType){case"checkNode":nodeEventCallback=_handler.onCheckNode;break;case"mouseoverCheck":nodeEventCallback=_handler.onMouseoverCheck;break;case"mouseoutCheck":nodeEventCallback=_handler.onMouseoutCheck}return{stop:"checkNode"===nodeEventType,node:node,nodeEventType:nodeEventType,nodeEventCallback:nodeEventCallback,treeEventType:"",treeEventCallback:null}},!0),data.addInitRoot(function(setting){data.getRoot(setting).radioCheckedList=[]}),data.addBeforeA(function(setting,node,html){setting.data.key.checked;setting.check.enable&&(data.makeChkFlag(setting,node),html.push("<span ID='",node.tId,consts.id.CHECK,"' class='",view.makeChkClass(setting,node),"' treeNode",consts.id.CHECK,!0===node.nocheck?" style='display:none;'":"","></span>"))}),data.addZTreeTools(function(setting,zTreeTools){zTreeTools.checkNode=function(node,checked,checkTypeFlag,callbackFlag){var checkedKey=this.setting.data.key.checked;if(!0!==node.chkDisabled&&(!0!==checked&&!1!==checked&&(checked=!node[checkedKey]),callbackFlag=!!callbackFlag,(node[checkedKey]!==checked||checkTypeFlag)&&(!callbackFlag||0!=tools.apply(this.setting.callback.beforeCheck,[this.setting.treeId,node],!0))&&tools.uCanDo(this.setting)&&this.setting.check.enable&&!0!==node.nocheck)){node[checkedKey]=checked;var checkObj=$$(node,consts.id.CHECK,this.setting);(checkTypeFlag||this.setting.check.chkStyle===consts.radio.STYLE)&&view.checkNodeRelation(this.setting,node),view.setChkClass(this.setting,checkObj,node),view.repairParentChkClassWithSelf(this.setting,node),callbackFlag&&this.setting.treeObj.trigger(consts.event.CHECK,[null,this.setting.treeId,node])}},zTreeTools.checkAllNodes=function(checked){view.repairAllChk(this.setting,!!checked)},zTreeTools.getCheckedNodes=function(checked){var childKey=this.setting.data.key.children;return checked=!1!==checked,data.getTreeCheckedNodes(this.setting,data.getRoot(this.setting)[childKey],checked)},zTreeTools.getChangeCheckedNodes=function(){var childKey=this.setting.data.key.children;return data.getTreeChangeCheckedNodes(this.setting,data.getRoot(this.setting)[childKey])},zTreeTools.setChkDisabled=function(node,disabled,inheritParent,inheritChildren){disabled=!!disabled,inheritParent=!!inheritParent,inheritChildren=!!inheritChildren,view.repairSonChkDisabled(this.setting,node,disabled,inheritChildren),view.repairParentChkDisabled(this.setting,node.getParentNode(),disabled,inheritParent)};var _updateNode=zTreeTools.updateNode;zTreeTools.updateNode=function(node,checkTypeFlag){if(_updateNode&&_updateNode.apply(zTreeTools,arguments),node&&this.setting.check.enable&&$$(node,this.setting).get(0)&&tools.uCanDo(this.setting)){var checkObj=$$(node,consts.id.CHECK,this.setting);1!=checkTypeFlag&&this.setting.check.chkStyle!==consts.radio.STYLE||view.checkNodeRelation(this.setting,node),view.setChkClass(this.setting,checkObj,node),view.repairParentChkClassWithSelf(this.setting,node)}}});var _createNodes=view.createNodes;view.createNodes=function(setting,level,nodes,parentNode,index){_createNodes&&_createNodes.apply(view,arguments),nodes&&view.repairParentChkClassWithSelf(setting,parentNode)};var _removeNode=view.removeNode;view.removeNode=function(setting,node){var parentNode=node.getParentNode();_removeNode&&_removeNode.apply(view,arguments),node&&parentNode&&(view.repairChkClass(setting,parentNode),view.repairParentChkClass(setting,parentNode))};var _appendNodes=view.appendNodes;view.appendNodes=function(setting,level,nodes,parentNode,index,initFlag,openFlag){var html="";return _appendNodes&&(html=_appendNodes.apply(view,arguments)),parentNode&&data.makeChkFlag(setting,parentNode),html}}(jQuery);