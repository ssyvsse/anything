!function($){var settings={},roots={},caches={},_consts={className:{BUTTON:"button",LEVEL:"level",ICO_LOADING:"ico_loading",SWITCH:"switch",NAME:"node_name"},event:{NODECREATED:"ztree_nodeCreated",CLICK:"ztree_click",EXPAND:"ztree_expand",COLLAPSE:"ztree_collapse",ASYNC_SUCCESS:"ztree_async_success",ASYNC_ERROR:"ztree_async_error",REMOVE:"ztree_remove",SELECTED:"ztree_selected",UNSELECTED:"ztree_unselected"},id:{A:"_a",ICON:"_ico",SPAN:"_span",SWITCH:"_switch",UL:"_ul"},line:{ROOT:"root",ROOTS:"roots",CENTER:"center",BOTTOM:"bottom",NOLINE:"noline",LINE:"line"},folder:{OPEN:"open",CLOSE:"close",DOCU:"docu"},node:{CURSELECTED:"curSelectedNode"}},_setting={treeId:"",treeObj:null,view:{addDiyDom:null,autoCancelSelected:!0,dblClickExpand:!0,expandSpeed:"fast",fontCss:{},nameIsHTML:!1,selectedMulti:!0,showIcon:!0,showLine:!0,showTitle:!0,txtSelectedEnable:!1},data:{key:{children:"children",name:"name",title:"",url:"url",icon:"icon"},simpleData:{enable:!1,idKey:"id",pIdKey:"pId",rootPId:null},keep:{parent:!1,leaf:!1}},async:{enable:!1,contentType:"application/x-www-form-urlencoded",type:"post",dataType:"text",url:"",autoParam:[],otherParam:[],dataFilter:null},callback:{beforeAsync:null,beforeClick:null,beforeDblClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeExpand:null,beforeCollapse:null,beforeRemove:null,onAsyncError:null,onAsyncSuccess:null,onNodeCreated:null,onClick:null,onDblClick:null,onRightClick:null,onMouseDown:null,onMouseUp:null,onExpand:null,onCollapse:null,onRemove:null}},_initRoot=function(setting){var r=data.getRoot(setting);r||(r={},data.setRoot(setting,r)),r[setting.data.key.children]=[],r.expandTriggerFlag=!1,r.curSelectedList=[],r.noSelection=!0,r.createdNodes=[],r.zId=0,r._ver=(new Date).getTime()},_initCache=function(setting){var c=data.getCache(setting);c||(c={},data.setCache(setting,c)),c.nodes=[],c.doms=[]},_bindEvent=function(setting){var o=setting.treeObj,c=consts.event;o.bind(c.NODECREATED,function(event,treeId,node){tools.apply(setting.callback.onNodeCreated,[event,treeId,node])}),o.bind(c.CLICK,function(event,srcEvent,treeId,node,clickFlag){tools.apply(setting.callback.onClick,[srcEvent,treeId,node,clickFlag])}),o.bind(c.EXPAND,function(event,treeId,node){tools.apply(setting.callback.onExpand,[event,treeId,node])}),o.bind(c.COLLAPSE,function(event,treeId,node){tools.apply(setting.callback.onCollapse,[event,treeId,node])}),o.bind(c.ASYNC_SUCCESS,function(event,treeId,node,msg){tools.apply(setting.callback.onAsyncSuccess,[event,treeId,node,msg])}),o.bind(c.ASYNC_ERROR,function(event,treeId,node,XMLHttpRequest,textStatus,errorThrown){tools.apply(setting.callback.onAsyncError,[event,treeId,node,XMLHttpRequest,textStatus,errorThrown])}),o.bind(c.REMOVE,function(event,treeId,treeNode){tools.apply(setting.callback.onRemove,[event,treeId,treeNode])}),o.bind(c.SELECTED,function(event,treeId,node){tools.apply(setting.callback.onSelected,[treeId,node])}),o.bind(c.UNSELECTED,function(event,treeId,node){tools.apply(setting.callback.onUnSelected,[treeId,node])})},_unbindEvent=function(setting){var o=setting.treeObj,c=consts.event;o.unbind(c.NODECREATED).unbind(c.CLICK).unbind(c.EXPAND).unbind(c.COLLAPSE).unbind(c.ASYNC_SUCCESS).unbind(c.ASYNC_ERROR).unbind(c.REMOVE).unbind(c.SELECTED).unbind(c.UNSELECTED)},_eventProxy=function(event){var target=event.target,setting=data.getSetting(event.data.treeId),tId="",node=null,nodeEventType="",treeEventType="",nodeEventCallback=null,treeEventCallback=null,tmp=null;if(tools.eqs(event.type,"mousedown")?treeEventType="mousedown":tools.eqs(event.type,"mouseup")?treeEventType="mouseup":tools.eqs(event.type,"contextmenu")?treeEventType="contextmenu":tools.eqs(event.type,"click")?tools.eqs(target.tagName,"span")&&null!==target.getAttribute("treeNode"+consts.id.SWITCH)?(tId=tools.getNodeMainDom(target).id,nodeEventType="switchNode"):(tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]))&&(tId=tools.getNodeMainDom(tmp).id,nodeEventType="clickNode"):tools.eqs(event.type,"dblclick")&&(treeEventType="dblclick",(tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]))&&(tId=tools.getNodeMainDom(tmp).id,nodeEventType="switchNode")),treeEventType.length>0&&0==tId.length&&(tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]))&&(tId=tools.getNodeMainDom(tmp).id),tId.length>0)switch(node=data.getNodeCache(setting,tId),nodeEventType){case"switchNode":node.isParent&&(tools.eqs(event.type,"click")||tools.eqs(event.type,"dblclick")&&tools.apply(setting.view.dblClickExpand,[setting.treeId,node],setting.view.dblClickExpand))?nodeEventCallback=handler.onSwitchNode:nodeEventType="";break;case"clickNode":nodeEventCallback=handler.onClickNode}switch(treeEventType){case"mousedown":treeEventCallback=handler.onZTreeMousedown;break;case"mouseup":treeEventCallback=handler.onZTreeMouseup;break;case"dblclick":treeEventCallback=handler.onZTreeDblclick;break;case"contextmenu":treeEventCallback=handler.onZTreeContextmenu}return{stop:!1,node:node,nodeEventType:nodeEventType,nodeEventCallback:nodeEventCallback,treeEventType:treeEventType,treeEventCallback:treeEventCallback}},_initNode=function(setting,level,n,parentNode,isFirstNode,isLastNode,openFlag){if(n){var r=data.getRoot(setting),childKey=setting.data.key.children;n.level=level,n.tId=setting.treeId+"_"+ ++r.zId,n.parentTId=parentNode?parentNode.tId:null,n.open="string"==typeof n.open?tools.eqs(n.open,"true"):!!n.open,n[childKey]&&n[childKey].length>0?(n.isParent=!0,n.zAsync=!0):(n.isParent="string"==typeof n.isParent?tools.eqs(n.isParent,"true"):!!n.isParent,n.open=!(!n.isParent||setting.async.enable)&&n.open,n.zAsync=!n.isParent),n.isFirstNode=isFirstNode,n.isLastNode=isLastNode,n.getParentNode=function(){return data.getNodeCache(setting,n.parentTId)},n.getPreNode=function(){return data.getPreNode(setting,n)},n.getNextNode=function(){return data.getNextNode(setting,n)},n.getIndex=function(){return data.getNodeIndex(setting,n)},n.getPath=function(){return data.getNodePath(setting,n)},n.isAjaxing=!1,data.fixPIdKeyValue(setting,n)}},_init={bind:[_bindEvent],unbind:[_unbindEvent],caches:[_initCache],nodes:[_initNode],proxys:[_eventProxy],roots:[_initRoot],beforeA:[],afterA:[],innerBeforeA:[],innerAfterA:[],zTreeTools:[]},data={addNodeCache:function(setting,node){data.getCache(setting).nodes[data.getNodeCacheId(node.tId)]=node},getNodeCacheId:function(tId){return tId.substring(tId.lastIndexOf("_")+1)},addAfterA:function(afterA){_init.afterA.push(afterA)},addBeforeA:function(beforeA){_init.beforeA.push(beforeA)},addInnerAfterA:function(innerAfterA){_init.innerAfterA.push(innerAfterA)},addInnerBeforeA:function(innerBeforeA){_init.innerBeforeA.push(innerBeforeA)},addInitBind:function(bindEvent){_init.bind.push(bindEvent)},addInitUnBind:function(unbindEvent){_init.unbind.push(unbindEvent)},addInitCache:function(initCache){_init.caches.push(initCache)},addInitNode:function(initNode){_init.nodes.push(initNode)},addInitProxy:function(initProxy,isFirst){isFirst?_init.proxys.splice(0,0,initProxy):_init.proxys.push(initProxy)},addInitRoot:function(initRoot){_init.roots.push(initRoot)},addNodesData:function(setting,parentNode,index,nodes){var params,childKey=setting.data.key.children;parentNode[childKey]?index>=parentNode[childKey].length&&(index=-1):(parentNode[childKey]=[],index=-1),parentNode[childKey].length>0&&0===index?(parentNode[childKey][0].isFirstNode=!1,view.setNodeLineIcos(setting,parentNode[childKey][0])):parentNode[childKey].length>0&&index<0&&(parentNode[childKey][parentNode[childKey].length-1].isLastNode=!1,view.setNodeLineIcos(setting,parentNode[childKey][parentNode[childKey].length-1])),parentNode.isParent=!0,index<0?parentNode[childKey]=parentNode[childKey].concat(nodes):(params=[index,0].concat(nodes),parentNode[childKey].splice.apply(parentNode[childKey],params))},addSelectedNode:function(setting,node){var root=data.getRoot(setting);data.isSelectedNode(setting,node)||root.curSelectedList.push(node)},addCreatedNode:function(setting,node){(setting.callback.onNodeCreated||setting.view.addDiyDom)&&data.getRoot(setting).createdNodes.push(node)},addZTreeTools:function(zTreeTools){_init.zTreeTools.push(zTreeTools)},exSetting:function(s){$.extend(!0,_setting,s)},fixPIdKeyValue:function(setting,node){setting.data.simpleData.enable&&(node[setting.data.simpleData.pIdKey]=node.parentTId?node.getParentNode()[setting.data.simpleData.idKey]:setting.data.simpleData.rootPId)},getAfterA:function(setting,node,array){for(var i=0,j=_init.afterA.length;i<j;i++)_init.afterA[i].apply(this,arguments)},getBeforeA:function(setting,node,array){for(var i=0,j=_init.beforeA.length;i<j;i++)_init.beforeA[i].apply(this,arguments)},getInnerAfterA:function(setting,node,array){for(var i=0,j=_init.innerAfterA.length;i<j;i++)_init.innerAfterA[i].apply(this,arguments)},getInnerBeforeA:function(setting,node,array){for(var i=0,j=_init.innerBeforeA.length;i<j;i++)_init.innerBeforeA[i].apply(this,arguments)},getCache:function(setting){return caches[setting.treeId]},getNodeIndex:function(setting,node){if(!node)return null;for(var childKey=setting.data.key.children,p=node.parentTId?node.getParentNode():data.getRoot(setting),i=0,l=p[childKey].length-1;i<=l;i++)if(p[childKey][i]===node)return i;return-1},getNextNode:function(setting,node){if(!node)return null;for(var childKey=setting.data.key.children,p=node.parentTId?node.getParentNode():data.getRoot(setting),i=0,l=p[childKey].length-1;i<=l;i++)if(p[childKey][i]===node)return i==l?null:p[childKey][i+1];return null},getNodeByParam:function(setting,nodes,key,value){if(!nodes||!key)return null;for(var childKey=setting.data.key.children,i=0,l=nodes.length;i<l;i++){if(nodes[i][key]==value)return nodes[i];var tmp=data.getNodeByParam(setting,nodes[i][childKey],key,value);if(tmp)return tmp}return null},getNodeCache:function(setting,tId){if(!tId)return null;var n=caches[setting.treeId].nodes[data.getNodeCacheId(tId)];return n||null},getNodeName:function(setting,node){return""+node[setting.data.key.name]},getNodePath:function(setting,node){return node?((path=node.parentTId?node.getParentNode().getPath():[])&&path.push(node),path):null;var path},getNodeTitle:function(setting,node){return""+node[""===setting.data.key.title?setting.data.key.name:setting.data.key.title]},getNodes:function(setting){return data.getRoot(setting)[setting.data.key.children]},getNodesByParam:function(setting,nodes,key,value){if(!nodes||!key)return[];for(var childKey=setting.data.key.children,result=[],i=0,l=nodes.length;i<l;i++)nodes[i][key]==value&&result.push(nodes[i]),result=result.concat(data.getNodesByParam(setting,nodes[i][childKey],key,value));return result},getNodesByParamFuzzy:function(setting,nodes,key,value){if(!nodes||!key)return[];var childKey=setting.data.key.children,result=[];value=value.toLowerCase();for(var i=0,l=nodes.length;i<l;i++)"string"==typeof nodes[i][key]&&nodes[i][key].toLowerCase().indexOf(value)>-1&&result.push(nodes[i]),result=result.concat(data.getNodesByParamFuzzy(setting,nodes[i][childKey],key,value));return result},getNodesByFilter:function(setting,nodes,filter,isSingle,invokeParam){if(!nodes)return isSingle?null:[];for(var childKey=setting.data.key.children,result=isSingle?null:[],i=0,l=nodes.length;i<l;i++){if(tools.apply(filter,[nodes[i],invokeParam],!1)){if(isSingle)return nodes[i];result.push(nodes[i])}var tmpResult=data.getNodesByFilter(setting,nodes[i][childKey],filter,isSingle,invokeParam);if(isSingle&&tmpResult)return tmpResult;result=isSingle?tmpResult:result.concat(tmpResult)}return result},getPreNode:function(setting,node){if(!node)return null;for(var childKey=setting.data.key.children,p=node.parentTId?node.getParentNode():data.getRoot(setting),i=0,l=p[childKey].length;i<l;i++)if(p[childKey][i]===node)return 0==i?null:p[childKey][i-1];return null},getRoot:function(setting){return setting?roots[setting.treeId]:null},getRoots:function(){return roots},getSetting:function(treeId){return settings[treeId]},getSettings:function(){return settings},getZTreeTools:function(treeId){var r=this.getRoot(this.getSetting(treeId));return r?r.treeTools:null},initCache:function(setting){for(var i=0,j=_init.caches.length;i<j;i++)_init.caches[i].apply(this,arguments)},initNode:function(setting,level,node,parentNode,preNode,nextNode){for(var i=0,j=_init.nodes.length;i<j;i++)_init.nodes[i].apply(this,arguments)},initRoot:function(setting){for(var i=0,j=_init.roots.length;i<j;i++)_init.roots[i].apply(this,arguments)},isSelectedNode:function(setting,node){for(var root=data.getRoot(setting),i=0,j=root.curSelectedList.length;i<j;i++)if(node===root.curSelectedList[i])return!0;return!1},removeNodeCache:function(setting,node){var childKey=setting.data.key.children;if(node[childKey])for(var i=0,l=node[childKey].length;i<l;i++)data.removeNodeCache(setting,node[childKey][i]);data.getCache(setting).nodes[data.getNodeCacheId(node.tId)]=null},removeSelectedNode:function(setting,node){for(var root=data.getRoot(setting),i=0,j=root.curSelectedList.length;i<j;i++)node!==root.curSelectedList[i]&&data.getNodeCache(setting,root.curSelectedList[i].tId)||(root.curSelectedList.splice(i,1),setting.treeObj.trigger(consts.event.UNSELECTED,[setting.treeId,node]),i--,j--)},setCache:function(setting,cache){caches[setting.treeId]=cache},setRoot:function(setting,root){roots[setting.treeId]=root},setZTreeTools:function(setting,zTreeTools){for(var i=0,j=_init.zTreeTools.length;i<j;i++)_init.zTreeTools[i].apply(this,arguments)},transformToArrayFormat:function(setting,nodes){if(!nodes)return[];var childKey=setting.data.key.children,r=[];if(tools.isArray(nodes))for(var i=0,l=nodes.length;i<l;i++)r.push(nodes[i]),nodes[i][childKey]&&(r=r.concat(data.transformToArrayFormat(setting,nodes[i][childKey])));else r.push(nodes),nodes[childKey]&&(r=r.concat(data.transformToArrayFormat(setting,nodes[childKey])));return r},transformTozTreeFormat:function(setting,sNodes){var i,l,key=setting.data.simpleData.idKey,parentKey=setting.data.simpleData.pIdKey,childKey=setting.data.key.children;if(!key||""==key||!sNodes)return[];if(tools.isArray(sNodes)){var r=[],tmpMap={};for(i=0,l=sNodes.length;i<l;i++)tmpMap[sNodes[i][key]]=sNodes[i];for(i=0,l=sNodes.length;i<l;i++)tmpMap[sNodes[i][parentKey]]&&sNodes[i][key]!=sNodes[i][parentKey]?(tmpMap[sNodes[i][parentKey]][childKey]||(tmpMap[sNodes[i][parentKey]][childKey]=[]),tmpMap[sNodes[i][parentKey]][childKey].push(sNodes[i])):r.push(sNodes[i]);return r}return[sNodes]}},event={bindEvent:function(setting){for(var i=0,j=_init.bind.length;i<j;i++)_init.bind[i].apply(this,arguments)},unbindEvent:function(setting){for(var i=0,j=_init.unbind.length;i<j;i++)_init.unbind[i].apply(this,arguments)},bindTree:function(setting){var eventParam={treeId:setting.treeId},o=setting.treeObj;setting.view.txtSelectedEnable||o.bind("selectstart",handler.onSelectStart).css({"-moz-user-select":"-moz-none"}),o.bind("click",eventParam,event.proxy),o.bind("dblclick",eventParam,event.proxy),o.bind("mouseover",eventParam,event.proxy),o.bind("mouseout",eventParam,event.proxy),o.bind("mousedown",eventParam,event.proxy),o.bind("mouseup",eventParam,event.proxy),o.bind("contextmenu",eventParam,event.proxy)},unbindTree:function(setting){setting.treeObj.unbind("selectstart",handler.onSelectStart).unbind("click",event.proxy).unbind("dblclick",event.proxy).unbind("mouseover",event.proxy).unbind("mouseout",event.proxy).unbind("mousedown",event.proxy).unbind("mouseup",event.proxy).unbind("contextmenu",event.proxy)},doProxy:function(e){for(var results=[],i=0,j=_init.proxys.length;i<j;i++){var proxyResult=_init.proxys[i].apply(this,arguments);if(results.push(proxyResult),proxyResult.stop)break}return results},proxy:function(e){var setting=data.getSetting(e.data.treeId);if(!tools.uCanDo(setting,e))return!0;for(var results=event.doProxy(e),r=!0,i=0,l=results.length;i<l;i++){var proxyResult=results[i];proxyResult.nodeEventCallback&&(!0,r=proxyResult.nodeEventCallback.apply(proxyResult,[e,proxyResult.node])&&r),proxyResult.treeEventCallback&&(!0,r=proxyResult.treeEventCallback.apply(proxyResult,[e,proxyResult.node])&&r)}return r}},handler={onSwitchNode:function(event,node){var setting=data.getSetting(event.data.treeId);if(node.open){if(0==tools.apply(setting.callback.beforeCollapse,[setting.treeId,node],!0))return!0;data.getRoot(setting).expandTriggerFlag=!0,view.switchNode(setting,node)}else{if(0==tools.apply(setting.callback.beforeExpand,[setting.treeId,node],!0))return!0;data.getRoot(setting).expandTriggerFlag=!0,view.switchNode(setting,node)}return!0},onClickNode:function(event,node){var setting=data.getSetting(event.data.treeId),clickFlag=setting.view.autoCancelSelected&&(event.ctrlKey||event.metaKey)&&data.isSelectedNode(setting,node)?0:setting.view.autoCancelSelected&&(event.ctrlKey||event.metaKey)&&setting.view.selectedMulti?2:1;return 0==tools.apply(setting.callback.beforeClick,[setting.treeId,node,clickFlag],!0)||(0===clickFlag?view.cancelPreSelectedNode(setting,node):view.selectNode(setting,node,2===clickFlag),setting.treeObj.trigger(consts.event.CLICK,[event,setting.treeId,node,clickFlag]),!0)},onZTreeMousedown:function(event,node){var setting=data.getSetting(event.data.treeId);return tools.apply(setting.callback.beforeMouseDown,[setting.treeId,node],!0)&&tools.apply(setting.callback.onMouseDown,[event,setting.treeId,node]),!0},onZTreeMouseup:function(event,node){var setting=data.getSetting(event.data.treeId);return tools.apply(setting.callback.beforeMouseUp,[setting.treeId,node],!0)&&tools.apply(setting.callback.onMouseUp,[event,setting.treeId,node]),!0},onZTreeDblclick:function(event,node){var setting=data.getSetting(event.data.treeId);return tools.apply(setting.callback.beforeDblClick,[setting.treeId,node],!0)&&tools.apply(setting.callback.onDblClick,[event,setting.treeId,node]),!0},onZTreeContextmenu:function(event,node){var setting=data.getSetting(event.data.treeId);return tools.apply(setting.callback.beforeRightClick,[setting.treeId,node],!0)&&tools.apply(setting.callback.onRightClick,[event,setting.treeId,node]),"function"!=typeof setting.callback.onRightClick},onSelectStart:function(e){var n=e.originalEvent.srcElement.nodeName.toLowerCase();return"input"===n||"textarea"===n}},tools={apply:function(fun,param,defaultValue){return"function"==typeof fun?fun.apply(zt,param||[]):defaultValue},canAsync:function(setting,node){var childKey=setting.data.key.children;return setting.async.enable&&node&&node.isParent&&!(node.zAsync||node[childKey]&&node[childKey].length>0)},clone:function(obj){if(null===obj)return null;var o=tools.isArray(obj)?[]:{};for(var i in obj)o[i]=obj[i]instanceof Date?new Date(obj[i].getTime()):"object"==typeof obj[i]?tools.clone(obj[i]):obj[i];return o},eqs:function(str1,str2){return str1.toLowerCase()===str2.toLowerCase()},isArray:function(arr){return"[object Array]"===Object.prototype.toString.apply(arr)},$:function(node,exp,setting){return exp&&"string"!=typeof exp&&(setting=exp,exp=""),"string"==typeof node?$(node,setting?setting.treeObj.get(0).ownerDocument:null):$("#"+node.tId+exp,setting?setting.treeObj:null)},getMDom:function(setting,curDom,targetExpr){if(!curDom)return null;for(;curDom&&curDom.id!==setting.treeId;){for(var i=0,l=targetExpr.length;curDom.tagName&&i<l;i++)if(tools.eqs(curDom.tagName,targetExpr[i].tagName)&&null!==curDom.getAttribute(targetExpr[i].attrName))return curDom;curDom=curDom.parentNode}return null},getNodeMainDom:function(target){return $(target).parent("li").get(0)||$(target).parentsUntil("li").parent().get(0)},isChildOrSelf:function(dom,parentId){return $(dom).closest("#"+parentId).length>0},uCanDo:function(setting,e){return!0}},view={addNodes:function(setting,parentNode,index,newNodes,isSilent){if(!setting.data.keep.leaf||!parentNode||parentNode.isParent)if(tools.isArray(newNodes)||(newNodes=[newNodes]),setting.data.simpleData.enable&&(newNodes=data.transformTozTreeFormat(setting,newNodes)),parentNode){var target_switchObj=$$(parentNode,consts.id.SWITCH,setting),target_icoObj=$$(parentNode,consts.id.ICON,setting),target_ulObj=$$(parentNode,consts.id.UL,setting);parentNode.open||(view.replaceSwitchClass(parentNode,target_switchObj,consts.folder.CLOSE),view.replaceIcoClass(parentNode,target_icoObj,consts.folder.CLOSE),parentNode.open=!1,target_ulObj.css({display:"none"})),data.addNodesData(setting,parentNode,index,newNodes),view.createNodes(setting,parentNode.level+1,newNodes,parentNode,index),isSilent||view.expandCollapseParentNode(setting,parentNode,!0)}else data.addNodesData(setting,data.getRoot(setting),index,newNodes),view.createNodes(setting,0,newNodes,null,index)},appendNodes:function(setting,level,nodes,parentNode,index,initFlag,openFlag){if(!nodes)return[];var isFirstNode,isLastNode,html=[],childKey=setting.data.key.children,tmpPChild=(parentNode||data.getRoot(setting))[childKey];(!tmpPChild||index>=tmpPChild.length)&&(index=-1);for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i];initFlag&&(isFirstNode=(0===index||tmpPChild.length==nodes.length)&&0==i,isLastNode=index<0&&i==nodes.length-1,data.initNode(setting,level,node,parentNode,isFirstNode,isLastNode,openFlag),data.addNodeCache(setting,node));var childHtml=[];node[childKey]&&node[childKey].length>0&&(childHtml=view.appendNodes(setting,level+1,node[childKey],node,-1,initFlag,openFlag&&node.open)),openFlag&&(view.makeDOMNodeMainBefore(html,setting,node),view.makeDOMNodeLine(html,setting,node),data.getBeforeA(setting,node,html),view.makeDOMNodeNameBefore(html,setting,node),data.getInnerBeforeA(setting,node,html),view.makeDOMNodeIcon(html,setting,node),data.getInnerAfterA(setting,node,html),view.makeDOMNodeNameAfter(html,setting,node),data.getAfterA(setting,node,html),node.isParent&&node.open&&view.makeUlHtml(setting,node,html,childHtml.join("")),view.makeDOMNodeMainAfter(html,setting,node),data.addCreatedNode(setting,node))}return html},appendParentULDom:function(setting,node){var html=[],nObj=$$(node,setting);!nObj.get(0)&&node.parentTId&&(view.appendParentULDom(setting,node.getParentNode()),nObj=$$(node,setting));var ulObj=$$(node,consts.id.UL,setting);ulObj.get(0)&&ulObj.remove();var childKey=setting.data.key.children,childHtml=view.appendNodes(setting,node.level+1,node[childKey],node,-1,!1,!0);view.makeUlHtml(setting,node,html,childHtml.join("")),nObj.append(html.join(""))},asyncNode:function(setting,node,isSilent,callback){var i,l;if(node&&!node.isParent)return tools.apply(callback),!1;if(node&&node.isAjaxing)return!1;if(0==tools.apply(setting.callback.beforeAsync,[setting.treeId,node],!0))return tools.apply(callback),!1;if(node){node.isAjaxing=!0;var icoObj=$$(node,consts.id.ICON,setting);icoObj.attr({style:"",class:consts.className.BUTTON+" "+consts.className.ICO_LOADING})}var tmpParam={};for(i=0,l=setting.async.autoParam.length;node&&i<l;i++){var pKey=setting.async.autoParam[i].split("="),spKey=pKey;pKey.length>1&&(spKey=pKey[1],pKey=pKey[0]),tmpParam[spKey]=node[pKey]}if(tools.isArray(setting.async.otherParam))for(i=0,l=setting.async.otherParam.length;i<l;i+=2)tmpParam[setting.async.otherParam[i]]=setting.async.otherParam[i+1];else for(var p in setting.async.otherParam)tmpParam[p]=setting.async.otherParam[p];var _tmpV=data.getRoot(setting)._ver;return $.ajax({contentType:setting.async.contentType,cache:!1,type:setting.async.type,url:tools.apply(setting.async.url,[setting.treeId,node],setting.async.url),data:setting.async.contentType.indexOf("application/json")>-1?JSON.stringify(tmpParam):tmpParam,dataType:setting.async.dataType,success:function(msg){if(_tmpV==data.getRoot(setting)._ver){var newNodes=[];try{newNodes=msg&&0!=msg.length?"string"==typeof msg?eval("("+msg+")"):msg:[]}catch(err){newNodes=msg}node&&(node.isAjaxing=null,node.zAsync=!0),view.setNodeLineIcos(setting,node),newNodes&&""!==newNodes?(newNodes=tools.apply(setting.async.dataFilter,[setting.treeId,node,newNodes],newNodes),view.addNodes(setting,node,-1,newNodes?tools.clone(newNodes):[],!!isSilent)):view.addNodes(setting,node,-1,[],!!isSilent),setting.treeObj.trigger(consts.event.ASYNC_SUCCESS,[setting.treeId,node,msg]),tools.apply(callback)}},error:function(XMLHttpRequest,textStatus,errorThrown){_tmpV==data.getRoot(setting)._ver&&(node&&(node.isAjaxing=null),view.setNodeLineIcos(setting,node),setting.treeObj.trigger(consts.event.ASYNC_ERROR,[setting.treeId,node,XMLHttpRequest,textStatus,errorThrown]))}}),!0},cancelPreSelectedNode:function(setting,node,excludeNode){var i,n,list=data.getRoot(setting).curSelectedList;for(i=list.length-1;i>=0;i--)if(node===(n=list[i])||!node&&(!excludeNode||excludeNode!==n)){if($$(n,consts.id.A,setting).removeClass(consts.node.CURSELECTED),node){data.removeSelectedNode(setting,node);break}list.splice(i,1),setting.treeObj.trigger(consts.event.UNSELECTED,[setting.treeId,n])}},createNodeCallback:function(setting){if(setting.callback.onNodeCreated||setting.view.addDiyDom)for(var root=data.getRoot(setting);root.createdNodes.length>0;){var node=root.createdNodes.shift();tools.apply(setting.view.addDiyDom,[setting.treeId,node]),setting.callback.onNodeCreated&&setting.treeObj.trigger(consts.event.NODECREATED,[setting.treeId,node])}},createNodes:function(setting,level,nodes,parentNode,index){if(nodes&&0!=nodes.length){var root=data.getRoot(setting),childKey=setting.data.key.children,openFlag=!parentNode||parentNode.open||!!$$(parentNode[childKey][0],setting).get(0);root.createdNodes=[];var parentObj,nextObj,zTreeHtml=view.appendNodes(setting,level,nodes,parentNode,index,!0,openFlag);if(parentNode){var ulObj=$$(parentNode,consts.id.UL,setting);ulObj.get(0)&&(parentObj=ulObj)}else parentObj=setting.treeObj;parentObj&&(index>=0&&(nextObj=parentObj.children()[index]),index>=0&&nextObj?$(nextObj).before(zTreeHtml.join("")):parentObj.append(zTreeHtml.join(""))),view.createNodeCallback(setting)}},destroy:function(setting){setting&&(data.initCache(setting),data.initRoot(setting),event.unbindTree(setting),event.unbindEvent(setting),setting.treeObj.empty(),delete settings[setting.treeId])},expandCollapseNode:function(setting,node,expandFlag,animateFlag,callback){var _callback,root=data.getRoot(setting),childKey=setting.data.key.children;if(node)if(root.expandTriggerFlag&&(_callback=callback,callback=function(){_callback&&_callback(),node.open?setting.treeObj.trigger(consts.event.EXPAND,[setting.treeId,node]):setting.treeObj.trigger(consts.event.COLLAPSE,[setting.treeId,node])},root.expandTriggerFlag=!1),!node.open&&node.isParent&&(!$$(node,consts.id.UL,setting).get(0)||node[childKey]&&node[childKey].length>0&&!$$(node[childKey][0],setting).get(0))&&(view.appendParentULDom(setting,node),view.createNodeCallback(setting)),node.open!=expandFlag){var ulObj=$$(node,consts.id.UL,setting),switchObj=$$(node,consts.id.SWITCH,setting),icoObj=$$(node,consts.id.ICON,setting);node.isParent?(node.open=!node.open,node.iconOpen&&node.iconClose&&icoObj.attr("style",view.makeNodeIcoStyle(setting,node)),node.open?(view.replaceSwitchClass(node,switchObj,consts.folder.OPEN),view.replaceIcoClass(node,icoObj,consts.folder.OPEN),0==animateFlag||""==setting.view.expandSpeed?(ulObj.show(),tools.apply(callback,[])):node[childKey]&&node[childKey].length>0?ulObj.slideDown(setting.view.expandSpeed,callback):(ulObj.show(),tools.apply(callback,[]))):(view.replaceSwitchClass(node,switchObj,consts.folder.CLOSE),view.replaceIcoClass(node,icoObj,consts.folder.CLOSE),0!=animateFlag&&""!=setting.view.expandSpeed&&node[childKey]&&node[childKey].length>0?ulObj.slideUp(setting.view.expandSpeed,callback):(ulObj.hide(),tools.apply(callback,[])))):tools.apply(callback,[])}else tools.apply(callback,[]);else tools.apply(callback,[])},expandCollapseParentNode:function(setting,node,expandFlag,animateFlag,callback){node&&(node.parentTId?(view.expandCollapseNode(setting,node,expandFlag,animateFlag),node.parentTId&&view.expandCollapseParentNode(setting,node.getParentNode(),expandFlag,animateFlag,callback)):view.expandCollapseNode(setting,node,expandFlag,animateFlag,callback))},expandCollapseSonNode:function(setting,node,expandFlag,animateFlag,callback){var root=data.getRoot(setting),childKey=setting.data.key.children,treeNodes=node?node[childKey]:root[childKey],selfAnimateSign=!node&&animateFlag,expandTriggerFlag=data.getRoot(setting).expandTriggerFlag;if(data.getRoot(setting).expandTriggerFlag=!1,treeNodes)for(var i=0,l=treeNodes.length;i<l;i++)treeNodes[i]&&view.expandCollapseSonNode(setting,treeNodes[i],expandFlag,selfAnimateSign);data.getRoot(setting).expandTriggerFlag=expandTriggerFlag,view.expandCollapseNode(setting,node,expandFlag,animateFlag,callback)},isSelectedNode:function(setting,node){if(!node)return!1;var i,list=data.getRoot(setting).curSelectedList;for(i=list.length-1;i>=0;i--)if(node===list[i])return!0;return!1},makeDOMNodeIcon:function(html,setting,node){var nameStr=data.getNodeName(setting,node),name=setting.view.nameIsHTML?nameStr:nameStr.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");html.push("<span id='",node.tId,consts.id.ICON,"' title='' treeNode",consts.id.ICON," class='",view.makeNodeIcoClass(setting,node),"' style='",view.makeNodeIcoStyle(setting,node),"'></span><span id='",node.tId,consts.id.SPAN,"' class='",consts.className.NAME,"'>",name,"</span>")},makeDOMNodeLine:function(html,setting,node){html.push("<span id='",node.tId,consts.id.SWITCH,"' title='' class='",view.makeNodeLineClass(setting,node),"' treeNode",consts.id.SWITCH,"></span>")},makeDOMNodeMainAfter:function(html,setting,node){html.push("</li>")},makeDOMNodeMainBefore:function(html,setting,node){html.push("<li id='",node.tId,"' class='",consts.className.LEVEL,node.level,"' tabindex='0' hidefocus='true' treenode>")},makeDOMNodeNameAfter:function(html,setting,node){html.push("</a>")},makeDOMNodeNameBefore:function(html,setting,node){var title=data.getNodeTitle(setting,node),url=view.makeNodeUrl(setting,node),fontcss=view.makeNodeFontCss(setting,node),fontStyle=[];for(var f in fontcss)fontStyle.push(f,":",fontcss[f],";");html.push("<a id='",node.tId,consts.id.A,"' class='",consts.className.LEVEL,node.level,"' treeNode",consts.id.A,' onclick="',node.click||"",'" ',null!=url&&url.length>0?"href='"+url+"'":""," target='",view.makeNodeTarget(node),"' style='",fontStyle.join(""),"'"),tools.apply(setting.view.showTitle,[setting.treeId,node],setting.view.showTitle)&&title&&html.push("title='",title.replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"'"),html.push(">")},makeNodeFontCss:function(setting,node){var fontCss=tools.apply(setting.view.fontCss,[setting.treeId,node],setting.view.fontCss);return fontCss&&"function"!=typeof fontCss?fontCss:{}},makeNodeIcoClass:function(setting,node){var icoCss=["ico"];return node.isAjaxing||(icoCss[0]=(node.iconSkin?node.iconSkin+"_":"")+icoCss[0],node.isParent?icoCss.push(node.open?consts.folder.OPEN:consts.folder.CLOSE):icoCss.push(consts.folder.DOCU)),consts.className.BUTTON+" "+icoCss.join("_")},makeNodeIcoStyle:function(setting,node){var icoStyle=[];if(!node.isAjaxing){var icon=node.isParent&&node.iconOpen&&node.iconClose?node.open?node.iconOpen:node.iconClose:node[setting.data.key.icon];icon&&icoStyle.push("background:url(",icon,") 0 0 no-repeat;"),0!=setting.view.showIcon&&tools.apply(setting.view.showIcon,[setting.treeId,node],!0)||icoStyle.push("width:0px;height:0px;")}return icoStyle.join("")},makeNodeLineClass:function(setting,node){var lineClass=[];return setting.view.showLine?0==node.level&&node.isFirstNode&&node.isLastNode?lineClass.push(consts.line.ROOT):0==node.level&&node.isFirstNode?lineClass.push(consts.line.ROOTS):node.isLastNode?lineClass.push(consts.line.BOTTOM):lineClass.push(consts.line.CENTER):lineClass.push(consts.line.NOLINE),node.isParent?lineClass.push(node.open?consts.folder.OPEN:consts.folder.CLOSE):lineClass.push(consts.folder.DOCU),view.makeNodeLineClassEx(node)+lineClass.join("_")},makeNodeLineClassEx:function(node){return consts.className.BUTTON+" "+consts.className.LEVEL+node.level+" "+consts.className.SWITCH+" "},makeNodeTarget:function(node){return node.target||"_blank"},makeNodeUrl:function(setting,node){var urlKey=setting.data.key.url;return node[urlKey]?node[urlKey]:null},makeUlHtml:function(setting,node,html,content){html.push("<ul id='",node.tId,consts.id.UL,"' class='",consts.className.LEVEL,node.level," ",view.makeUlLineClass(setting,node),"' style='display:",node.open?"block":"none","'>"),html.push(content),html.push("</ul>")},makeUlLineClass:function(setting,node){return setting.view.showLine&&!node.isLastNode?consts.line.LINE:""},removeChildNodes:function(setting,node){if(node){var childKey=setting.data.key.children,nodes=node[childKey];if(nodes){for(var i=0,l=nodes.length;i<l;i++)data.removeNodeCache(setting,nodes[i]);if(data.removeSelectedNode(setting),delete node[childKey],setting.data.keep.parent)$$(node,consts.id.UL,setting).empty();else{node.isParent=!1,node.open=!1;var tmp_switchObj=$$(node,consts.id.SWITCH,setting),tmp_icoObj=$$(node,consts.id.ICON,setting);view.replaceSwitchClass(node,tmp_switchObj,consts.folder.DOCU),view.replaceIcoClass(node,tmp_icoObj,consts.folder.DOCU),$$(node,consts.id.UL,setting).remove()}}}},scrollIntoView:function(dom){dom&&(Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(centerIfNeeded){function withinBounds(value,min,max,extent){return!1===centerIfNeeded||max<=value+extent&&value<=min+extent?Math.min(max,Math.max(min,value)):(min+max)/2}for(var parent,elem=this,area=function makeArea(left,top,width,height){return{left:left,top:top,width:width,height:height,right:left+width,bottom:top+height,translate:function(x,y){return makeArea(x+left,y+top,width,height)},relativeFromTo:function(lhs,rhs){var newLeft=left,newTop=top;if((lhs=lhs.offsetParent)===(rhs=rhs.offsetParent))return area;for(;lhs;lhs=lhs.offsetParent)newLeft+=lhs.offsetLeft+lhs.clientLeft,newTop+=lhs.offsetTop+lhs.clientTop;for(;rhs;rhs=rhs.offsetParent)newLeft-=rhs.offsetLeft+rhs.clientLeft,newTop-=rhs.offsetTop+rhs.clientTop;return makeArea(newLeft,newTop,width,height)}}}(this.offsetLeft,this.offsetTop,this.offsetWidth,this.offsetHeight);(parent=elem.parentNode)instanceof HTMLElement;){var clientLeft=parent.offsetLeft+parent.clientLeft,clientTop=parent.offsetTop+parent.clientTop;area=area.relativeFromTo(elem,parent).translate(-clientLeft,-clientTop),parent.scrollLeft=withinBounds(parent.scrollLeft,area.right-parent.clientWidth,area.left,parent.clientWidth),parent.scrollTop=withinBounds(parent.scrollTop,area.bottom-parent.clientHeight,area.top,parent.clientHeight),area=area.translate(clientLeft-parent.scrollLeft,clientTop-parent.scrollTop),elem=parent}}),dom.scrollIntoViewIfNeeded())},setFirstNode:function(setting,parentNode){var childKey=setting.data.key.children;parentNode[childKey].length>0&&(parentNode[childKey][0].isFirstNode=!0)},setLastNode:function(setting,parentNode){var childKey=setting.data.key.children,childLength=parentNode[childKey].length;childLength>0&&(parentNode[childKey][childLength-1].isLastNode=!0)},removeNode:function(setting,node){var root=data.getRoot(setting),childKey=setting.data.key.children,parentNode=node.parentTId?node.getParentNode():root;if(node.isFirstNode=!1,node.isLastNode=!1,node.getPreNode=function(){return null},node.getNextNode=function(){return null},data.getNodeCache(setting,node.tId)){$$(node,setting).remove(),data.removeNodeCache(setting,node),data.removeSelectedNode(setting,node);for(var i=0,l=parentNode[childKey].length;i<l;i++)if(parentNode[childKey][i].tId==node.tId){parentNode[childKey].splice(i,1);break}view.setFirstNode(setting,parentNode),view.setLastNode(setting,parentNode);var tmp_ulObj,tmp_switchObj,tmp_icoObj,childLength=parentNode[childKey].length;if(setting.data.keep.parent||0!=childLength){if(setting.view.showLine&&childLength>0){var newLast=parentNode[childKey][childLength-1];if(tmp_ulObj=$$(newLast,consts.id.UL,setting),tmp_switchObj=$$(newLast,consts.id.SWITCH,setting),tmp_icoObj=$$(newLast,consts.id.ICON,setting),parentNode==root)if(1==parentNode[childKey].length)view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.ROOT);else{var tmp_first_switchObj=$$(parentNode[childKey][0],consts.id.SWITCH,setting);view.replaceSwitchClass(parentNode[childKey][0],tmp_first_switchObj,consts.line.ROOTS),view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.BOTTOM)}else view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.BOTTOM);tmp_ulObj.removeClass(consts.line.LINE)}}else parentNode.isParent=!1,parentNode.open=!1,tmp_ulObj=$$(parentNode,consts.id.UL,setting),tmp_switchObj=$$(parentNode,consts.id.SWITCH,setting),tmp_icoObj=$$(parentNode,consts.id.ICON,setting),view.replaceSwitchClass(parentNode,tmp_switchObj,consts.folder.DOCU),view.replaceIcoClass(parentNode,tmp_icoObj,consts.folder.DOCU),tmp_ulObj.css("display","none")}},replaceIcoClass:function(node,obj,newName){if(obj&&!node.isAjaxing){var tmpName=obj.attr("class");if(void 0!=tmpName){var tmpList=tmpName.split("_");switch(newName){case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:tmpList[tmpList.length-1]=newName}obj.attr("class",tmpList.join("_"))}}},replaceSwitchClass:function(node,obj,newName){if(obj){var tmpName=obj.attr("class");if(void 0!=tmpName){var tmpList=tmpName.split("_");switch(newName){case consts.line.ROOT:case consts.line.ROOTS:case consts.line.CENTER:case consts.line.BOTTOM:case consts.line.NOLINE:tmpList[0]=view.makeNodeLineClassEx(node)+newName;break;case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:tmpList[1]=newName}obj.attr("class",tmpList.join("_")),newName!==consts.folder.DOCU?obj.removeAttr("disabled"):obj.attr("disabled","disabled")}}},selectNode:function(setting,node,addFlag){addFlag||view.cancelPreSelectedNode(setting,null,node),$$(node,consts.id.A,setting).addClass(consts.node.CURSELECTED),data.addSelectedNode(setting,node),setting.treeObj.trigger(consts.event.SELECTED,[setting.treeId,node])},setNodeFontCss:function(setting,treeNode){var aObj=$$(treeNode,consts.id.A,setting),fontCss=view.makeNodeFontCss(setting,treeNode);fontCss&&aObj.css(fontCss)},setNodeLineIcos:function(setting,node){if(node){var switchObj=$$(node,consts.id.SWITCH,setting),ulObj=$$(node,consts.id.UL,setting),icoObj=$$(node,consts.id.ICON,setting),ulLine=view.makeUlLineClass(setting,node);0==ulLine.length?ulObj.removeClass(consts.line.LINE):ulObj.addClass(ulLine),switchObj.attr("class",view.makeNodeLineClass(setting,node)),node.isParent?switchObj.removeAttr("disabled"):switchObj.attr("disabled","disabled"),icoObj.removeAttr("style"),icoObj.attr("style",view.makeNodeIcoStyle(setting,node)),icoObj.attr("class",view.makeNodeIcoClass(setting,node))}},setNodeName:function(setting,node){var title=data.getNodeTitle(setting,node),nObj=$$(node,consts.id.SPAN,setting);(nObj.empty(),setting.view.nameIsHTML?nObj.html(data.getNodeName(setting,node)):nObj.text(data.getNodeName(setting,node)),tools.apply(setting.view.showTitle,[setting.treeId,node],setting.view.showTitle))&&$$(node,consts.id.A,setting).attr("title",title||"")},setNodeTarget:function(setting,node){$$(node,consts.id.A,setting).attr("target",view.makeNodeTarget(node))},setNodeUrl:function(setting,node){var aObj=$$(node,consts.id.A,setting),url=view.makeNodeUrl(setting,node);null==url||0==url.length?aObj.removeAttr("href"):aObj.attr("href",url)},switchNode:function(setting,node){if(node.open||!tools.canAsync(setting,node))view.expandCollapseNode(setting,node,!node.open);else if(setting.async.enable){if(!view.asyncNode(setting,node))return void view.expandCollapseNode(setting,node,!node.open)}else node&&view.expandCollapseNode(setting,node,!node.open)}};$.fn.zTree={consts:_consts,_z:{tools:tools,view:view,event:event,data:data},getZTreeObj:function(treeId){var o=data.getZTreeTools(treeId);return o||null},destroy:function(treeId){if(treeId&&treeId.length>0)view.destroy(data.getSetting(treeId));else for(var s in settings)view.destroy(settings[s])},init:function(obj,zSetting,zNodes){var setting=tools.clone(_setting);$.extend(!0,setting,zSetting),setting.treeId=obj.attr("id"),setting.treeObj=obj,setting.treeObj.empty(),settings[setting.treeId]=setting,void 0===document.body.style.maxHeight&&(setting.view.expandSpeed=""),data.initRoot(setting);var root=data.getRoot(setting),childKey=setting.data.key.children;zNodes=zNodes?tools.clone(tools.isArray(zNodes)?zNodes:[zNodes]):[],setting.data.simpleData.enable?root[childKey]=data.transformTozTreeFormat(setting,zNodes):root[childKey]=zNodes,data.initCache(setting),event.unbindTree(setting),event.bindTree(setting),event.unbindEvent(setting),event.bindEvent(setting);var zTreeTools={setting:setting,addNodes:function(parentNode,index,newNodes,isSilent){if(parentNode||(parentNode=null),parentNode&&!parentNode.isParent&&setting.data.keep.leaf)return null;var i=parseInt(index,10);if(isNaN(i)?(isSilent=!!newNodes,newNodes=index,index=-1):index=i,!newNodes)return null;var xNewNodes=tools.clone(tools.isArray(newNodes)?newNodes:[newNodes]);function addCallback(){view.addNodes(setting,parentNode,index,xNewNodes,1==isSilent)}return tools.canAsync(setting,parentNode)?view.asyncNode(setting,parentNode,isSilent,addCallback):addCallback(),xNewNodes},cancelSelectedNode:function(node){view.cancelPreSelectedNode(setting,node)},destroy:function(){view.destroy(setting)},expandAll:function(expandFlag){return expandFlag=!!expandFlag,view.expandCollapseSonNode(setting,null,expandFlag,!0),expandFlag},expandNode:function(node,expandFlag,sonSign,focus,callbackFlag){return node&&node.isParent?(!0!==expandFlag&&!1!==expandFlag&&(expandFlag=!node.open),(callbackFlag=!!callbackFlag)&&expandFlag&&0==tools.apply(setting.callback.beforeExpand,[setting.treeId,node],!0)?null:callbackFlag&&!expandFlag&&0==tools.apply(setting.callback.beforeCollapse,[setting.treeId,node],!0)?null:(expandFlag&&node.parentTId&&view.expandCollapseParentNode(setting,node.getParentNode(),expandFlag,!1),expandFlag!==node.open||sonSign?(data.getRoot(setting).expandTriggerFlag=callbackFlag,!tools.canAsync(setting,node)&&sonSign?view.expandCollapseSonNode(setting,node,expandFlag,!0,showNodeFocus):(node.open=!expandFlag,view.switchNode(this.setting,node),showNodeFocus()),expandFlag):null)):null;function showNodeFocus(){var a=$$(node,setting).get(0);a&&!1!==focus&&view.scrollIntoView(a)}},getNodes:function(){return data.getNodes(setting)},getNodeByParam:function(key,value,parentNode){return key?data.getNodeByParam(setting,parentNode?parentNode[setting.data.key.children]:data.getNodes(setting),key,value):null},getNodeByTId:function(tId){return data.getNodeCache(setting,tId)},getNodesByParam:function(key,value,parentNode){return key?data.getNodesByParam(setting,parentNode?parentNode[setting.data.key.children]:data.getNodes(setting),key,value):null},getNodesByParamFuzzy:function(key,value,parentNode){return key?data.getNodesByParamFuzzy(setting,parentNode?parentNode[setting.data.key.children]:data.getNodes(setting),key,value):null},getNodesByFilter:function(filter,isSingle,parentNode,invokeParam){return isSingle=!!isSingle,filter&&"function"==typeof filter?data.getNodesByFilter(setting,parentNode?parentNode[setting.data.key.children]:data.getNodes(setting),filter,isSingle,invokeParam):isSingle?null:[]},getNodeIndex:function(node){if(!node)return null;for(var childKey=setting.data.key.children,parentNode=node.parentTId?node.getParentNode():data.getRoot(setting),i=0,l=parentNode[childKey].length;i<l;i++)if(parentNode[childKey][i]==node)return i;return-1},getSelectedNodes:function(){for(var r=[],list=data.getRoot(setting).curSelectedList,i=0,l=list.length;i<l;i++)r.push(list[i]);return r},isSelectedNode:function(node){return data.isSelectedNode(setting,node)},reAsyncChildNodes:function(parentNode,reloadType,isSilent){if(this.setting.async.enable){var isRoot=!parentNode;if(isRoot&&(parentNode=data.getRoot(setting)),"refresh"==reloadType){for(var childKey=this.setting.data.key.children,i=0,l=parentNode[childKey]?parentNode[childKey].length:0;i<l;i++)data.removeNodeCache(setting,parentNode[childKey][i]);if(data.removeSelectedNode(setting),parentNode[childKey]=[],isRoot)this.setting.treeObj.empty();else $$(parentNode,consts.id.UL,setting).empty()}view.asyncNode(this.setting,isRoot?null:parentNode,!!isSilent)}},refresh:function(){this.setting.treeObj.empty();var root=data.getRoot(setting),nodes=root[setting.data.key.children];data.initRoot(setting),root[setting.data.key.children]=nodes,data.initCache(setting),view.createNodes(setting,0,root[setting.data.key.children],null,-1)},removeChildNodes:function(node){if(!node)return null;var nodes=node[setting.data.key.children];return view.removeChildNodes(setting,node),nodes||null},removeNode:function(node,callbackFlag){node&&((callbackFlag=!!callbackFlag)&&0==tools.apply(setting.callback.beforeRemove,[setting.treeId,node],!0)||(view.removeNode(setting,node),callbackFlag&&this.setting.treeObj.trigger(consts.event.REMOVE,[setting.treeId,node])))},selectNode:function(node,addFlag,isSilent){if(node&&tools.uCanDo(setting)){if(addFlag=setting.view.selectedMulti&&addFlag,node.parentTId)view.expandCollapseParentNode(setting,node.getParentNode(),!0,!1,function(){if(isSilent)return;var a=$$(node,setting).get(0);view.scrollIntoView(a)});else if(!isSilent)try{$$(node,setting).focus().blur()}catch(e){}view.selectNode(setting,node,addFlag)}},transformTozTreeNodes:function(simpleNodes){return data.transformTozTreeFormat(setting,simpleNodes)},transformToArray:function(nodes){return data.transformToArrayFormat(setting,nodes)},updateNode:function(node,checkTypeFlag){node&&($$(node,setting).get(0)&&tools.uCanDo(setting)&&(view.setNodeName(setting,node),view.setNodeTarget(setting,node),view.setNodeUrl(setting,node),view.setNodeLineIcos(setting,node),view.setNodeFontCss(setting,node)))}};return root.treeTools=zTreeTools,data.setZTreeTools(setting,zTreeTools),root[childKey]&&root[childKey].length>0?view.createNodes(setting,0,root[childKey],null,-1):setting.async.enable&&setting.async.url&&""!==setting.async.url&&view.asyncNode(setting),zTreeTools}};var zt=$.fn.zTree,$$=tools.$,consts=zt.consts}(jQuery),function($){var _consts={event:{CHECK:"ztree_check"},id:{CHECK:"_check"},checkbox:{STYLE:"checkbox",DEFAULT:"chk",DISABLED:"disable",FALSE:"false",TRUE:"true",FULL:"full",PART:"part",FOCUS:"focus"},radio:{STYLE:"radio",TYPE_ALL:"all",TYPE_LEVEL:"level"}},_setting={check:{enable:!1,autoCheckTrigger:!1,chkStyle:_consts.checkbox.STYLE,nocheckInherit:!1,chkDisabledInherit:!1,radioType:_consts.radio.TYPE_LEVEL,chkboxType:{Y:"ps",N:"ps"}},data:{key:{checked:"checked"}},callback:{beforeCheck:null,onCheck:null}},_handler={onCheckNode:function(event,node){if(!0===node.chkDisabled)return!1;var setting=data.getSetting(event.data.treeId),checkedKey=setting.data.key.checked;if(0==tools.apply(setting.callback.beforeCheck,[setting.treeId,node],!0))return!0;node[checkedKey]=!node[checkedKey],view.checkNodeRelation(setting,node);var checkObj=$$(node,consts.id.CHECK,setting);return view.setChkClass(setting,checkObj,node),view.repairParentChkClassWithSelf(setting,node),setting.treeObj.trigger(consts.event.CHECK,[event,setting.treeId,node]),!0},onMouseoverCheck:function(event,node){if(!0===node.chkDisabled)return!1;var setting=data.getSetting(event.data.treeId),checkObj=$$(node,consts.id.CHECK,setting);return node.check_Focus=!0,view.setChkClass(setting,checkObj,node),!0},onMouseoutCheck:function(event,node){if(!0===node.chkDisabled)return!1;var setting=data.getSetting(event.data.treeId),checkObj=$$(node,consts.id.CHECK,setting);return node.check_Focus=!1,view.setChkClass(setting,checkObj,node),!0}},_z={tools:{},view:{checkNodeRelation:function(setting,node){var pNode,i,l,childKey=setting.data.key.children,checkedKey=setting.data.key.checked,r=consts.radio;if(setting.check.chkStyle==r.STYLE){var checkedList=data.getRadioCheckedList(setting);if(node[checkedKey])if(setting.check.radioType==r.TYPE_ALL){for(i=checkedList.length-1;i>=0;i--)(pNode=checkedList[i])[checkedKey]&&pNode!=node&&(pNode[checkedKey]=!1,checkedList.splice(i,1),view.setChkClass(setting,$$(pNode,consts.id.CHECK,setting),pNode),pNode.parentTId!=node.parentTId&&view.repairParentChkClassWithSelf(setting,pNode));checkedList.push(node)}else{var parentNode=node.parentTId?node.getParentNode():data.getRoot(setting);for(i=0,l=parentNode[childKey].length;i<l;i++)(pNode=parentNode[childKey][i])[checkedKey]&&pNode!=node&&(pNode[checkedKey]=!1,view.setChkClass(setting,$$(pNode,consts.id.CHECK,setting),pNode))}else if(setting.check.radioType==r.TYPE_ALL)for(i=0,l=checkedList.length;i<l;i++)if(node==checkedList[i]){checkedList.splice(i,1);break}}else node[checkedKey]&&(!node[childKey]||0==node[childKey].length||setting.check.chkboxType.Y.indexOf("s")>-1)&&view.setSonNodeCheckBox(setting,node,!0),node[checkedKey]||node[childKey]&&0!=node[childKey].length&&!(setting.check.chkboxType.N.indexOf("s")>-1)||view.setSonNodeCheckBox(setting,node,!1),node[checkedKey]&&setting.check.chkboxType.Y.indexOf("p")>-1&&view.setParentNodeCheckBox(setting,node,!0),!node[checkedKey]&&setting.check.chkboxType.N.indexOf("p")>-1&&view.setParentNodeCheckBox(setting,node,!1)},makeChkClass:function(setting,node){var checkedKey=setting.data.key.checked,c=consts.checkbox,r=consts.radio,fullStyle="";fullStyle=!0===node.chkDisabled?c.DISABLED:node.halfCheck?c.PART:setting.check.chkStyle==r.STYLE?node.check_Child_State<1?c.FULL:c.PART:node[checkedKey]?2===node.check_Child_State||-1===node.check_Child_State?c.FULL:c.PART:node.check_Child_State<1?c.FULL:c.PART;var chkName=setting.check.chkStyle+"_"+(node[checkedKey]?c.TRUE:c.FALSE)+"_"+fullStyle;return chkName=node.check_Focus&&!0!==node.chkDisabled?chkName+"_"+c.FOCUS:chkName,consts.className.BUTTON+" "+c.DEFAULT+" "+chkName},repairAllChk:function(setting,checked){if(setting.check.enable&&setting.check.chkStyle===consts.checkbox.STYLE)for(var checkedKey=setting.data.key.checked,childKey=setting.data.key.children,root=data.getRoot(setting),i=0,l=root[childKey].length;i<l;i++){var node=root[childKey][i];!0!==node.nocheck&&!0!==node.chkDisabled&&(node[checkedKey]=checked),view.setSonNodeCheckBox(setting,node,checked)}},repairChkClass:function(setting,node){if(node&&(data.makeChkFlag(setting,node),!0!==node.nocheck)){var checkObj=$$(node,consts.id.CHECK,setting);view.setChkClass(setting,checkObj,node)}},repairParentChkClass:function(setting,node){if(node&&node.parentTId){var pNode=node.getParentNode();view.repairChkClass(setting,pNode),view.repairParentChkClass(setting,pNode)}},repairParentChkClassWithSelf:function(setting,node){if(node){var childKey=setting.data.key.children;node[childKey]&&node[childKey].length>0?view.repairParentChkClass(setting,node[childKey][0]):view.repairParentChkClass(setting,node)}},repairSonChkDisabled:function(setting,node,chkDisabled,inherit){if(node){var childKey=setting.data.key.children;if(node.chkDisabled!=chkDisabled&&(node.chkDisabled=chkDisabled),view.repairChkClass(setting,node),node[childKey]&&inherit)for(var i=0,l=node[childKey].length;i<l;i++){var sNode=node[childKey][i];view.repairSonChkDisabled(setting,sNode,chkDisabled,inherit)}}},repairParentChkDisabled:function(setting,node,chkDisabled,inherit){node&&(node.chkDisabled!=chkDisabled&&inherit&&(node.chkDisabled=chkDisabled),view.repairChkClass(setting,node),view.repairParentChkDisabled(setting,node.getParentNode(),chkDisabled,inherit))},setChkClass:function(setting,obj,node){obj&&(!0===node.nocheck?obj.hide():obj.show(),obj.attr("class",view.makeChkClass(setting,node)))},setParentNodeCheckBox:function(setting,node,value,srcNode){var childKey=setting.data.key.children,checkedKey=setting.data.key.checked,checkObj=$$(node,consts.id.CHECK,setting);if(srcNode||(srcNode=node),data.makeChkFlag(setting,node),!0!==node.nocheck&&!0!==node.chkDisabled&&(node[checkedKey]=value,view.setChkClass(setting,checkObj,node),setting.check.autoCheckTrigger&&node!=srcNode&&setting.treeObj.trigger(consts.event.CHECK,[null,setting.treeId,node])),node.parentTId){var pSign=!0;if(!value)for(var pNodes=node.getParentNode()[childKey],i=0,l=pNodes.length;i<l;i++)if(!0!==pNodes[i].nocheck&&!0!==pNodes[i].chkDisabled&&pNodes[i][checkedKey]||(!0===pNodes[i].nocheck||!0===pNodes[i].chkDisabled)&&pNodes[i].check_Child_State>0){pSign=!1;break}pSign&&view.setParentNodeCheckBox(setting,node.getParentNode(),value,srcNode)}},setSonNodeCheckBox:function(setting,node,value,srcNode){if(node){var childKey=setting.data.key.children,checkedKey=setting.data.key.checked,checkObj=$$(node,consts.id.CHECK,setting);srcNode||(srcNode=node);var hasDisable=!1;if(node[childKey])for(var i=0,l=node[childKey].length;i<l;i++){var sNode=node[childKey][i];view.setSonNodeCheckBox(setting,sNode,value,srcNode),!0===sNode.chkDisabled&&(hasDisable=!0)}node!=data.getRoot(setting)&&!0!==node.chkDisabled&&(hasDisable&&!0!==node.nocheck&&data.makeChkFlag(setting,node),!0!==node.nocheck&&!0!==node.chkDisabled?(node[checkedKey]=value,hasDisable||(node.check_Child_State=node[childKey]&&node[childKey].length>0?value?2:0:-1)):node.check_Child_State=-1,view.setChkClass(setting,checkObj,node),setting.check.autoCheckTrigger&&node!=srcNode&&!0!==node.nocheck&&!0!==node.chkDisabled&&setting.treeObj.trigger(consts.event.CHECK,[null,setting.treeId,node]))}}},event:{},data:{getRadioCheckedList:function(setting){for(var checkedList=data.getRoot(setting).radioCheckedList,i=0,j=checkedList.length;i<j;i++)data.getNodeCache(setting,checkedList[i].tId)||(checkedList.splice(i,1),i--,j--);return checkedList},getCheckStatus:function(setting,node){if(!setting.check.enable||node.nocheck||node.chkDisabled)return null;var checkedKey=setting.data.key.checked;return{checked:node[checkedKey],half:node.halfCheck?node.halfCheck:setting.check.chkStyle==consts.radio.STYLE?2===node.check_Child_State:node[checkedKey]?node.check_Child_State>-1&&node.check_Child_State<2:node.check_Child_State>0}},getTreeCheckedNodes:function(setting,nodes,checked,results){if(!nodes)return[];var childKey=setting.data.key.children,checkedKey=setting.data.key.checked,onlyOne=checked&&setting.check.chkStyle==consts.radio.STYLE&&setting.check.radioType==consts.radio.TYPE_ALL;results=results||[];for(var i=0,l=nodes.length;i<l&&(!0===nodes[i].nocheck||!0===nodes[i].chkDisabled||nodes[i][checkedKey]!=checked||(results.push(nodes[i]),!onlyOne))&&(data.getTreeCheckedNodes(setting,nodes[i][childKey],checked,results),!(onlyOne&&results.length>0));i++);return results},getTreeChangeCheckedNodes:function(setting,nodes,results){if(!nodes)return[];var childKey=setting.data.key.children,checkedKey=setting.data.key.checked;results=results||[];for(var i=0,l=nodes.length;i<l;i++)!0!==nodes[i].nocheck&&!0!==nodes[i].chkDisabled&&nodes[i][checkedKey]!=nodes[i].checkedOld&&results.push(nodes[i]),data.getTreeChangeCheckedNodes(setting,nodes[i][childKey],results);return results},makeChkFlag:function(setting,node){if(node){var childKey=setting.data.key.children,checkedKey=setting.data.key.checked,chkFlag=-1;if(node[childKey])for(var i=0,l=node[childKey].length;i<l;i++){var cNode=node[childKey][i],tmp=-1;if(setting.check.chkStyle==consts.radio.STYLE){if(2==(tmp=!0===cNode.nocheck||!0===cNode.chkDisabled?cNode.check_Child_State:!0===cNode.halfCheck?2:cNode[checkedKey]?2:cNode.check_Child_State>0?2:0)){chkFlag=2;break}0==tmp&&(chkFlag=0)}else if(setting.check.chkStyle==consts.checkbox.STYLE){if(1===(tmp=!0===cNode.nocheck||!0===cNode.chkDisabled?cNode.check_Child_State:!0===cNode.halfCheck?1:cNode[checkedKey]?-1===cNode.check_Child_State||2===cNode.check_Child_State?2:1:cNode.check_Child_State>0?1:0)){chkFlag=1;break}if(2===tmp&&chkFlag>-1&&i>0&&tmp!==chkFlag){chkFlag=1;break}if(2===chkFlag&&tmp>-1&&tmp<2){chkFlag=1;break}tmp>-1&&(chkFlag=tmp)}}node.check_Child_State=chkFlag}}}};$.extend(!0,$.fn.zTree.consts,_consts),$.extend(!0,$.fn.zTree._z,_z);var zt=$.fn.zTree,tools=zt._z.tools,consts=zt.consts,view=zt._z.view,data=zt._z.data,$$=(zt._z.event,tools.$);data.exSetting(_setting),data.addInitBind(function(setting){var o=setting.treeObj,c=consts.event;o.bind(c.CHECK,function(event,srcEvent,treeId,node){event.srcEvent=srcEvent,tools.apply(setting.callback.onCheck,[event,treeId,node])})}),data.addInitUnBind(function(setting){var o=setting.treeObj,c=consts.event;o.unbind(c.CHECK)}),data.addInitCache(function(treeId){}),data.addInitNode(function(setting,level,n,parentNode,isFirstNode,isLastNode,openFlag){if(n){var checkedKey=setting.data.key.checked;"string"==typeof n[checkedKey]&&(n[checkedKey]=tools.eqs(n[checkedKey],"true")),n[checkedKey]=!!n[checkedKey],n.checkedOld=n[checkedKey],"string"==typeof n.nocheck&&(n.nocheck=tools.eqs(n.nocheck,"true")),n.nocheck=!!n.nocheck||setting.check.nocheckInherit&&parentNode&&!!parentNode.nocheck,"string"==typeof n.chkDisabled&&(n.chkDisabled=tools.eqs(n.chkDisabled,"true")),n.chkDisabled=!!n.chkDisabled||setting.check.chkDisabledInherit&&parentNode&&!!parentNode.chkDisabled,"string"==typeof n.halfCheck&&(n.halfCheck=tools.eqs(n.halfCheck,"true")),n.halfCheck=!!n.halfCheck,n.check_Child_State=-1,n.check_Focus=!1,n.getCheckStatus=function(){return data.getCheckStatus(setting,n)},setting.check.chkStyle==consts.radio.STYLE&&setting.check.radioType==consts.radio.TYPE_ALL&&n[checkedKey]&&data.getRoot(setting).radioCheckedList.push(n)}}),data.addInitProxy(function(e){var target=e.target,setting=data.getSetting(e.data.treeId),tId="",node=null,nodeEventType="",nodeEventCallback=null;if(tools.eqs(e.type,"mouseover")?setting.check.enable&&tools.eqs(target.tagName,"span")&&null!==target.getAttribute("treeNode"+consts.id.CHECK)&&(tId=tools.getNodeMainDom(target).id,nodeEventType="mouseoverCheck"):tools.eqs(e.type,"mouseout")?setting.check.enable&&tools.eqs(target.tagName,"span")&&null!==target.getAttribute("treeNode"+consts.id.CHECK)&&(tId=tools.getNodeMainDom(target).id,nodeEventType="mouseoutCheck"):tools.eqs(e.type,"click")&&setting.check.enable&&tools.eqs(target.tagName,"span")&&null!==target.getAttribute("treeNode"+consts.id.CHECK)&&(tId=tools.getNodeMainDom(target).id,nodeEventType="checkNode"),tId.length>0)switch(node=data.getNodeCache(setting,tId),nodeEventType){case"checkNode":nodeEventCallback=_handler.onCheckNode;break;case"mouseoverCheck":nodeEventCallback=_handler.onMouseoverCheck;break;case"mouseoutCheck":nodeEventCallback=_handler.onMouseoutCheck}return{stop:"checkNode"===nodeEventType,node:node,nodeEventType:nodeEventType,nodeEventCallback:nodeEventCallback,treeEventType:"",treeEventCallback:null}},!0),data.addInitRoot(function(setting){data.getRoot(setting).radioCheckedList=[]}),data.addBeforeA(function(setting,node,html){setting.data.key.checked;setting.check.enable&&(data.makeChkFlag(setting,node),html.push("<span ID='",node.tId,consts.id.CHECK,"' class='",view.makeChkClass(setting,node),"' treeNode",consts.id.CHECK,!0===node.nocheck?" style='display:none;'":"","></span>"))}),data.addZTreeTools(function(setting,zTreeTools){zTreeTools.checkNode=function(node,checked,checkTypeFlag,callbackFlag){var checkedKey=this.setting.data.key.checked;if(!0!==node.chkDisabled&&(!0!==checked&&!1!==checked&&(checked=!node[checkedKey]),callbackFlag=!!callbackFlag,(node[checkedKey]!==checked||checkTypeFlag)&&(!callbackFlag||0!=tools.apply(this.setting.callback.beforeCheck,[this.setting.treeId,node],!0))&&tools.uCanDo(this.setting)&&this.setting.check.enable&&!0!==node.nocheck)){node[checkedKey]=checked;var checkObj=$$(node,consts.id.CHECK,this.setting);(checkTypeFlag||this.setting.check.chkStyle===consts.radio.STYLE)&&view.checkNodeRelation(this.setting,node),view.setChkClass(this.setting,checkObj,node),view.repairParentChkClassWithSelf(this.setting,node),callbackFlag&&this.setting.treeObj.trigger(consts.event.CHECK,[null,this.setting.treeId,node])}},zTreeTools.checkAllNodes=function(checked){view.repairAllChk(this.setting,!!checked)},zTreeTools.getCheckedNodes=function(checked){var childKey=this.setting.data.key.children;return checked=!1!==checked,data.getTreeCheckedNodes(this.setting,data.getRoot(this.setting)[childKey],checked)},zTreeTools.getChangeCheckedNodes=function(){var childKey=this.setting.data.key.children;return data.getTreeChangeCheckedNodes(this.setting,data.getRoot(this.setting)[childKey])},zTreeTools.setChkDisabled=function(node,disabled,inheritParent,inheritChildren){disabled=!!disabled,inheritParent=!!inheritParent,inheritChildren=!!inheritChildren,view.repairSonChkDisabled(this.setting,node,disabled,inheritChildren),view.repairParentChkDisabled(this.setting,node.getParentNode(),disabled,inheritParent)};var _updateNode=zTreeTools.updateNode;zTreeTools.updateNode=function(node,checkTypeFlag){if(_updateNode&&_updateNode.apply(zTreeTools,arguments),node&&this.setting.check.enable&&$$(node,this.setting).get(0)&&tools.uCanDo(this.setting)){var checkObj=$$(node,consts.id.CHECK,this.setting);1!=checkTypeFlag&&this.setting.check.chkStyle!==consts.radio.STYLE||view.checkNodeRelation(this.setting,node),view.setChkClass(this.setting,checkObj,node),view.repairParentChkClassWithSelf(this.setting,node)}}});var _createNodes=view.createNodes;view.createNodes=function(setting,level,nodes,parentNode,index){_createNodes&&_createNodes.apply(view,arguments),nodes&&view.repairParentChkClassWithSelf(setting,parentNode)};var _removeNode=view.removeNode;view.removeNode=function(setting,node){var parentNode=node.getParentNode();_removeNode&&_removeNode.apply(view,arguments),node&&parentNode&&(view.repairChkClass(setting,parentNode),view.repairParentChkClass(setting,parentNode))};var _appendNodes=view.appendNodes;view.appendNodes=function(setting,level,nodes,parentNode,index,initFlag,openFlag){var html="";return _appendNodes&&(html=_appendNodes.apply(view,arguments)),parentNode&&data.makeChkFlag(setting,parentNode),html}}(jQuery),function($){var _consts={event:{DRAG:"ztree_drag",DROP:"ztree_drop",RENAME:"ztree_rename",DRAGMOVE:"ztree_dragmove"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},_handler={onHoverOverNode:function(event,node){var setting=data.getSetting(event.data.treeId),root=data.getRoot(setting);root.curHoverNode!=node&&_handler.onHoverOutNode(event),root.curHoverNode=node,view.addHoverDom(setting,node)},onHoverOutNode:function(event,node){var setting=data.getSetting(event.data.treeId),root=data.getRoot(setting);root.curHoverNode&&!data.isSelectedNode(setting,root.curHoverNode)&&(view.removeTreeDom(setting,root.curHoverNode),root.curHoverNode=null)},onMousedownNode:function(eventMouseDown,_node){var i,l,setting=data.getSetting(eventMouseDown.data.treeId),root=data.getRoot(setting),roots=data.getRoots();if(2==eventMouseDown.button||!setting.edit.enable||!setting.edit.drag.isCopy&&!setting.edit.drag.isMove)return!0;var target=eventMouseDown.target,_nodes=data.getRoot(setting).curSelectedList,nodes=[];if(data.isSelectedNode(setting,_node))for(i=0,l=_nodes.length;i<l;i++){if(_nodes[i].editNameFlag&&tools.eqs(target.tagName,"input")&&null!==target.getAttribute("treeNode"+consts.id.INPUT))return!0;if(nodes.push(_nodes[i]),nodes[0].parentTId!==_nodes[i].parentTId){nodes=[_node];break}}else nodes=[_node];view.editNodeBlur=!0,view.cancelCurEditNode(setting);var curNode,tmpArrow,tmpTarget,preNode,nextNode,doc=$(setting.treeObj.get(0).ownerDocument),body=$(setting.treeObj.get(0).ownerDocument.body),isOtherTree=!1,targetSetting=setting,sourceSetting=setting,preTmpTargetNodeId=null,preTmpMoveType=null,tmpTargetNodeId=null,moveType=consts.move.TYPE_INNER,mouseDownX=eventMouseDown.clientX,mouseDownY=eventMouseDown.clientY,startTime=(new Date).getTime();function _docMouseMove(event){if(0==root.dragFlag&&Math.abs(mouseDownX-event.clientX)<setting.edit.drag.minMoveSize&&Math.abs(mouseDownY-event.clientY)<setting.edit.drag.minMoveSize)return!0;var i,l,tmpNode,tmpDom,tmpNodes,childKey=setting.data.key.children;if(body.css("cursor","pointer"),0==root.dragFlag){if(0==tools.apply(setting.callback.beforeDrag,[setting.treeId,nodes],!0))return _docMouseUp(event),!0;for(i=0,l=nodes.length;i<l;i++)0==i&&(root.dragNodeShowBefore=[]),(tmpNode=nodes[i]).isParent&&tmpNode.open?(view.expandCollapseNode(setting,tmpNode,!tmpNode.open),root.dragNodeShowBefore[tmpNode.tId]=!0):root.dragNodeShowBefore[tmpNode.tId]=!1;root.dragFlag=1,roots.showHoverDom=!1,tools.showIfameMask(setting,!0);var isOrder=!0,lastIndex=-1;if(nodes.length>1){var pNodes=nodes[0].parentTId?nodes[0].getParentNode()[childKey]:data.getNodes(setting);for(tmpNodes=[],i=0,l=pNodes.length;i<l;i++)if(void 0!==root.dragNodeShowBefore[pNodes[i].tId]&&(isOrder&&lastIndex>-1&&lastIndex+1!==i&&(isOrder=!1),tmpNodes.push(pNodes[i]),lastIndex=i),nodes.length===tmpNodes.length){nodes=tmpNodes;break}}for(isOrder&&(preNode=nodes[0].getPreNode(),nextNode=nodes[nodes.length-1].getNextNode()),curNode=$$("<ul class='zTreeDragUL'></ul>",setting),i=0,l=nodes.length;i<l;i++)(tmpNode=nodes[i]).editNameFlag=!1,view.selectNode(setting,tmpNode,i>0),view.removeTreeDom(setting,tmpNode),i>setting.edit.drag.maxShowNodeNum-1||((tmpDom=$$("<li id='"+tmpNode.tId+"_tmp'></li>",setting)).append($$(tmpNode,consts.id.A,setting).clone()),tmpDom.css("padding","0"),tmpDom.children("#"+tmpNode.tId+consts.id.A).removeClass(consts.node.CURSELECTED),curNode.append(tmpDom),i==setting.edit.drag.maxShowNodeNum-1&&(tmpDom=$$("<li id='"+tmpNode.tId+"_moretmp'><a>  ...  </a></li>",setting),curNode.append(tmpDom)));curNode.attr("id",nodes[0].tId+consts.id.UL+"_tmp"),curNode.addClass(setting.treeObj.attr("class")),curNode.appendTo(body),(tmpArrow=$$("<span class='tmpzTreeMove_arrow'></span>",setting)).attr("id","zTreeMove_arrow_tmp"),tmpArrow.appendTo(body),setting.treeObj.trigger(consts.event.DRAG,[event,setting.treeId,nodes])}if(1==root.dragFlag){if(tmpTarget&&tmpArrow.attr("id")==event.target.id&&tmpTargetNodeId&&event.clientX+doc.scrollLeft()+2>$("#"+tmpTargetNodeId+consts.id.A,tmpTarget).offset().left){var xT=$("#"+tmpTargetNodeId+consts.id.A,tmpTarget);event.target=xT.length>0?xT.get(0):event.target}else tmpTarget&&(tmpTarget.removeClass(consts.node.TMPTARGET_TREE),tmpTargetNodeId&&$("#"+tmpTargetNodeId+consts.id.A,tmpTarget).removeClass(consts.node.TMPTARGET_NODE+"_"+consts.move.TYPE_PREV).removeClass(consts.node.TMPTARGET_NODE+"_"+_consts.move.TYPE_NEXT).removeClass(consts.node.TMPTARGET_NODE+"_"+_consts.move.TYPE_INNER));tmpTarget=null,tmpTargetNodeId=null,isOtherTree=!1,targetSetting=setting;var settings=data.getSettings();for(var s in settings)settings[s].treeId&&settings[s].edit.enable&&settings[s].treeId!=setting.treeId&&(event.target.id==settings[s].treeId||$(event.target).parents("#"+settings[s].treeId).length>0)&&(isOtherTree=!0,targetSetting=settings[s]);var docScrollTop=doc.scrollTop(),docScrollLeft=doc.scrollLeft(),treeOffset=targetSetting.treeObj.offset(),scrollHeight=targetSetting.treeObj.get(0).scrollHeight,scrollWidth=targetSetting.treeObj.get(0).scrollWidth,dTop=event.clientY+docScrollTop-treeOffset.top,dBottom=targetSetting.treeObj.height()+treeOffset.top-event.clientY-docScrollTop,dLeft=event.clientX+docScrollLeft-treeOffset.left,dRight=targetSetting.treeObj.width()+treeOffset.left-event.clientX-docScrollLeft,isTop=dTop<setting.edit.drag.borderMax&&dTop>setting.edit.drag.borderMin,isBottom=dBottom<setting.edit.drag.borderMax&&dBottom>setting.edit.drag.borderMin,isLeft=dLeft<setting.edit.drag.borderMax&&dLeft>setting.edit.drag.borderMin,isRight=dRight<setting.edit.drag.borderMax&&dRight>setting.edit.drag.borderMin,isTreeInner=dTop>setting.edit.drag.borderMin&&dBottom>setting.edit.drag.borderMin&&dLeft>setting.edit.drag.borderMin&&dRight>setting.edit.drag.borderMin,isTreeTop=isTop&&targetSetting.treeObj.scrollTop()<=0,isTreeBottom=isBottom&&targetSetting.treeObj.scrollTop()+targetSetting.treeObj.height()+10>=scrollHeight,isTreeLeft=isLeft&&targetSetting.treeObj.scrollLeft()<=0,isTreeRight=isRight&&targetSetting.treeObj.scrollLeft()+targetSetting.treeObj.width()+10>=scrollWidth;if(event.target&&tools.isChildOrSelf(event.target,targetSetting.treeId)){for(var targetObj=event.target;targetObj&&targetObj.tagName&&!tools.eqs(targetObj.tagName,"li")&&targetObj.id!=targetSetting.treeId;)targetObj=targetObj.parentNode;var canMove=!0;for(i=0,l=nodes.length;i<l;i++){if(tmpNode=nodes[i],targetObj.id===tmpNode.tId){canMove=!1;break}if($$(tmpNode,setting).find("#"+targetObj.id).length>0){canMove=!1;break}}canMove&&event.target&&tools.isChildOrSelf(event.target,targetObj.id+consts.id.A)&&(tmpTarget=$(targetObj),tmpTargetNodeId=targetObj.id)}tmpNode=nodes[0],isTreeInner&&tools.isChildOrSelf(event.target,targetSetting.treeId)&&(!tmpTarget&&(event.target.id==targetSetting.treeId||isTreeTop||isTreeBottom||isTreeLeft||isTreeRight)&&(isOtherTree||!isOtherTree&&tmpNode.parentTId)&&(tmpTarget=targetSetting.treeObj),isTop?targetSetting.treeObj.scrollTop(targetSetting.treeObj.scrollTop()-10):isBottom&&targetSetting.treeObj.scrollTop(targetSetting.treeObj.scrollTop()+10),isLeft?targetSetting.treeObj.scrollLeft(targetSetting.treeObj.scrollLeft()-10):isRight&&targetSetting.treeObj.scrollLeft(targetSetting.treeObj.scrollLeft()+10),tmpTarget&&tmpTarget!=targetSetting.treeObj&&tmpTarget.offset().left<targetSetting.treeObj.offset().left&&targetSetting.treeObj.scrollLeft(targetSetting.treeObj.scrollLeft()+tmpTarget.offset().left-targetSetting.treeObj.offset().left)),curNode.css({top:event.clientY+docScrollTop+3+"px",left:event.clientX+docScrollLeft+3+"px"});var dX=0,dY=0;if(tmpTarget&&tmpTarget.attr("id")!=targetSetting.treeId){var tmpTargetNode=null==tmpTargetNodeId?null:data.getNodeCache(targetSetting,tmpTargetNodeId),isCopy=(event.ctrlKey||event.metaKey)&&setting.edit.drag.isMove&&setting.edit.drag.isCopy||!setting.edit.drag.isMove&&setting.edit.drag.isCopy,isPrev=!(!preNode||tmpTargetNodeId!==preNode.tId),isNext=!(!nextNode||tmpTargetNodeId!==nextNode.tId),isInner=tmpNode.parentTId&&tmpNode.parentTId==tmpTargetNodeId,canPrev=(isCopy||!isNext)&&tools.apply(targetSetting.edit.drag.prev,[targetSetting.treeId,nodes,tmpTargetNode],!!targetSetting.edit.drag.prev),canNext=(isCopy||!isPrev)&&tools.apply(targetSetting.edit.drag.next,[targetSetting.treeId,nodes,tmpTargetNode],!!targetSetting.edit.drag.next),canInner=(isCopy||!isInner)&&!(targetSetting.data.keep.leaf&&!tmpTargetNode.isParent)&&tools.apply(targetSetting.edit.drag.inner,[targetSetting.treeId,nodes,tmpTargetNode],!!targetSetting.edit.drag.inner);function clearMove(){tmpTarget=null,tmpTargetNodeId="",moveType=consts.move.TYPE_INNER,tmpArrow.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null)}if(canPrev||canNext||canInner){var tmpTargetA=$("#"+tmpTargetNodeId+consts.id.A,tmpTarget),tmpNextA=tmpTargetNode.isLastNode?null:$("#"+tmpTargetNode.getNextNode().tId+consts.id.A,tmpTarget.next()),tmpTop=tmpTargetA.offset().top,tmpLeft=tmpTargetA.offset().left,prevPercent=canPrev?canInner?.25:canNext?.5:1:-1,nextPercent=canNext?canInner?.75:canPrev?.5:0:-1,dY_percent=(event.clientY+docScrollTop-tmpTop)/tmpTargetA.height();if((1==prevPercent||dY_percent<=prevPercent&&dY_percent>=-.2)&&canPrev?(dX=1-tmpArrow.width(),dY=tmpTop-tmpArrow.height()/2,moveType=consts.move.TYPE_PREV):(0==nextPercent||dY_percent>=nextPercent&&dY_percent<=1.2)&&canNext?(dX=1-tmpArrow.width(),dY=null==tmpNextA||tmpTargetNode.isParent&&tmpTargetNode.open?tmpTop+tmpTargetA.height()-tmpArrow.height()/2:tmpNextA.offset().top-tmpArrow.height()/2,moveType=consts.move.TYPE_NEXT):canInner?(dX=5-tmpArrow.width(),dY=tmpTop,moveType=consts.move.TYPE_INNER):clearMove(),tmpTarget&&(tmpArrow.css({display:"block",top:dY+"px",left:tmpLeft+dX+"px"}),tmpTargetA.addClass(consts.node.TMPTARGET_NODE+"_"+moveType),preTmpTargetNodeId==tmpTargetNodeId&&preTmpMoveType==moveType||(startTime=(new Date).getTime()),tmpTargetNode&&tmpTargetNode.isParent&&moveType==consts.move.TYPE_INNER)){var startTimer=!0;window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==tmpTargetNode.tId?(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null):window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===tmpTargetNode.tId&&(startTimer=!1),startTimer&&(window.zTreeMoveTimer=setTimeout(function(){moveType==consts.move.TYPE_INNER&&tmpTargetNode&&tmpTargetNode.isParent&&!tmpTargetNode.open&&(new Date).getTime()-startTime>targetSetting.edit.drag.autoOpenTime&&tools.apply(targetSetting.callback.beforeDragOpen,[targetSetting.treeId,tmpTargetNode],!0)&&(view.switchNode(targetSetting,tmpTargetNode),targetSetting.edit.drag.autoExpandTrigger&&targetSetting.treeObj.trigger(consts.event.EXPAND,[targetSetting.treeId,tmpTargetNode]))},targetSetting.edit.drag.autoOpenTime+50),window.zTreeMoveTargetNodeTId=tmpTargetNode.tId)}}else clearMove()}else moveType=consts.move.TYPE_INNER,tmpTarget&&tools.apply(targetSetting.edit.drag.inner,[targetSetting.treeId,nodes,null],!!targetSetting.edit.drag.inner)?tmpTarget.addClass(consts.node.TMPTARGET_TREE):tmpTarget=null,tmpArrow.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null);preTmpTargetNodeId=tmpTargetNodeId,preTmpMoveType=moveType,setting.treeObj.trigger(consts.event.DRAGMOVE,[event,setting.treeId,nodes])}return!1}function _docMouseUp(event){if(window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null),preTmpTargetNodeId=null,preTmpMoveType=null,doc.unbind("mousemove",_docMouseMove),doc.unbind("mouseup",_docMouseUp),doc.unbind("selectstart",_docSelect),body.css("cursor","auto"),tmpTarget&&(tmpTarget.removeClass(consts.node.TMPTARGET_TREE),tmpTargetNodeId&&$("#"+tmpTargetNodeId+consts.id.A,tmpTarget).removeClass(consts.node.TMPTARGET_NODE+"_"+consts.move.TYPE_PREV).removeClass(consts.node.TMPTARGET_NODE+"_"+_consts.move.TYPE_NEXT).removeClass(consts.node.TMPTARGET_NODE+"_"+_consts.move.TYPE_INNER)),tools.showIfameMask(setting,!1),roots.showHoverDom=!0,0!=root.dragFlag){var i,l,tmpNode;for(root.dragFlag=0,i=0,l=nodes.length;i<l;i++)(tmpNode=nodes[i]).isParent&&root.dragNodeShowBefore[tmpNode.tId]&&!tmpNode.open&&(view.expandCollapseNode(setting,tmpNode,!tmpNode.open),delete root.dragNodeShowBefore[tmpNode.tId]);curNode&&curNode.remove(),tmpArrow&&tmpArrow.remove();var isCopy=(event.ctrlKey||event.metaKey)&&setting.edit.drag.isMove&&setting.edit.drag.isCopy||!setting.edit.drag.isMove&&setting.edit.drag.isCopy;if(!isCopy&&tmpTarget&&tmpTargetNodeId&&nodes[0].parentTId&&tmpTargetNodeId==nodes[0].parentTId&&moveType==consts.move.TYPE_INNER&&(tmpTarget=null),tmpTarget){var dragTargetNode=null==tmpTargetNodeId?null:data.getNodeCache(targetSetting,tmpTargetNodeId);if(0==tools.apply(setting.callback.beforeDrop,[targetSetting.treeId,nodes,dragTargetNode,moveType,isCopy],!0))return void view.selectNodes(sourceSetting,nodes);var newNodes=isCopy?tools.clone(nodes):nodes;function dropCallback(){if(isOtherTree){if(!isCopy)for(var i=0,l=nodes.length;i<l;i++)view.removeNode(setting,nodes[i]);moveType==consts.move.TYPE_INNER?view.addNodes(targetSetting,dragTargetNode,-1,newNodes):view.addNodes(targetSetting,dragTargetNode.getParentNode(),moveType==consts.move.TYPE_PREV?dragTargetNode.getIndex():dragTargetNode.getIndex()+1,newNodes)}else if(isCopy&&moveType==consts.move.TYPE_INNER)view.addNodes(targetSetting,dragTargetNode,-1,newNodes);else if(isCopy)view.addNodes(targetSetting,dragTargetNode.getParentNode(),moveType==consts.move.TYPE_PREV?dragTargetNode.getIndex():dragTargetNode.getIndex()+1,newNodes);else if(moveType!=consts.move.TYPE_NEXT)for(i=0,l=newNodes.length;i<l;i++)view.moveNode(targetSetting,dragTargetNode,newNodes[i],moveType,!1);else for(i=-1,l=newNodes.length-1;i<l;l--)view.moveNode(targetSetting,dragTargetNode,newNodes[l],moveType,!1);view.selectNodes(targetSetting,newNodes);var a=$$(newNodes[0],setting).get(0);view.scrollIntoView(a),setting.treeObj.trigger(consts.event.DROP,[event,targetSetting.treeId,newNodes,dragTargetNode,moveType,isCopy])}moveType==consts.move.TYPE_INNER&&tools.canAsync(targetSetting,dragTargetNode)?view.asyncNode(targetSetting,dragTargetNode,!1,dropCallback):dropCallback()}else view.selectNodes(sourceSetting,nodes),setting.treeObj.trigger(consts.event.DROP,[event,setting.treeId,nodes,null,null,null])}}function _docSelect(){return!1}return tools.uCanDo(setting)&&doc.bind("mousemove",_docMouseMove),doc.bind("mouseup",_docMouseUp),doc.bind("selectstart",_docSelect),eventMouseDown.preventDefault&&eventMouseDown.preventDefault(),!0}},_z={tools:{getAbs:function(obj){var oRect=obj.getBoundingClientRect(),scrollTop=document.body.scrollTop+document.documentElement.scrollTop,scrollLeft=document.body.scrollLeft+document.documentElement.scrollLeft;return[oRect.left+scrollLeft,oRect.top+scrollTop]},inputFocus:function(inputObj){inputObj.get(0)&&(inputObj.focus(),tools.setCursorPosition(inputObj.get(0),inputObj.val().length))},inputSelect:function(inputObj){inputObj.get(0)&&(inputObj.focus(),inputObj.select())},setCursorPosition:function(obj,pos){if(obj.setSelectionRange)obj.focus(),obj.setSelectionRange(pos,pos);else if(obj.createTextRange){var range=obj.createTextRange();range.collapse(!0),range.moveEnd("character",pos),range.moveStart("character",pos),range.select()}},showIfameMask:function(setting,showSign){for(var root=data.getRoot(setting);root.dragMaskList.length>0;)root.dragMaskList[0].remove(),root.dragMaskList.shift();if(showSign)for(var iframeList=$$("iframe",setting),i=0,l=iframeList.length;i<l;i++){var obj=iframeList.get(i),r=tools.getAbs(obj),dragMask=$$("<div id='zTreeMask_"+i+"' class='zTreeMask' style='top:"+r[1]+"px; left:"+r[0]+"px; width:"+obj.offsetWidth+"px; height:"+obj.offsetHeight+"px;'></div>",setting);dragMask.appendTo($$("body",setting)),root.dragMaskList.push(dragMask)}}},view:{addEditBtn:function(setting,node){if(!(node.editNameFlag||$$(node,consts.id.EDIT,setting).length>0)&&tools.apply(setting.edit.showRenameBtn,[setting.treeId,node],setting.edit.showRenameBtn)){var aObj=$$(node,consts.id.A,setting),editStr="<span class='"+consts.className.BUTTON+" edit' id='"+node.tId+consts.id.EDIT+"' title='"+tools.apply(setting.edit.renameTitle,[setting.treeId,node],setting.edit.renameTitle)+"' treeNode"+consts.id.EDIT+" style='display:none;'></span>";aObj.append(editStr),$$(node,consts.id.EDIT,setting).bind("click",function(){return!(!tools.uCanDo(setting)||0==tools.apply(setting.callback.beforeEditName,[setting.treeId,node],!0))&&(view.editNode(setting,node),!1)}).show()}},addRemoveBtn:function(setting,node){if(!(node.editNameFlag||$$(node,consts.id.REMOVE,setting).length>0)&&tools.apply(setting.edit.showRemoveBtn,[setting.treeId,node],setting.edit.showRemoveBtn)){var aObj=$$(node,consts.id.A,setting),removeStr="<span class='"+consts.className.BUTTON+" remove' id='"+node.tId+consts.id.REMOVE+"' title='"+tools.apply(setting.edit.removeTitle,[setting.treeId,node],setting.edit.removeTitle)+"' treeNode"+consts.id.REMOVE+" style='display:none;'></span>";aObj.append(removeStr),$$(node,consts.id.REMOVE,setting).bind("click",function(){return!(!tools.uCanDo(setting)||0==tools.apply(setting.callback.beforeRemove,[setting.treeId,node],!0))&&(view.removeNode(setting,node),setting.treeObj.trigger(consts.event.REMOVE,[setting.treeId,node]),!1)}).bind("mousedown",function(eventMouseDown){return!0}).show()}},addHoverDom:function(setting,node){data.getRoots().showHoverDom&&(node.isHover=!0,setting.edit.enable&&(view.addEditBtn(setting,node),view.addRemoveBtn(setting,node)),tools.apply(setting.view.addHoverDom,[setting.treeId,node]))},cancelCurEditNode:function(setting,forceName,isCancel){var root=data.getRoot(setting),nameKey=setting.data.key.name,node=root.curEditNode;if(node){var inputObj=root.curEditInput,newName=forceName||(isCancel?node[nameKey]:inputObj.val());if(!1===tools.apply(setting.callback.beforeRename,[setting.treeId,node,newName,isCancel],!0))return!1;node[nameKey]=newName,$$(node,consts.id.A,setting).removeClass(consts.node.CURSELECTED_EDIT),inputObj.unbind(),view.setNodeName(setting,node),node.editNameFlag=!1,root.curEditNode=null,root.curEditInput=null,view.selectNode(setting,node,!1),setting.treeObj.trigger(consts.event.RENAME,[setting.treeId,node,isCancel])}return root.noSelection=!0,!0},editNode:function(setting,node){var root=data.getRoot(setting);if(view.editNodeBlur=!1,data.isSelectedNode(setting,node)&&root.curEditNode==node&&node.editNameFlag)setTimeout(function(){tools.inputFocus(root.curEditInput)},0);else{var nameKey=setting.data.key.name;node.editNameFlag=!0,view.removeTreeDom(setting,node),view.cancelCurEditNode(setting),view.selectNode(setting,node,!1),$$(node,consts.id.SPAN,setting).html("<input type=text class='rename' id='"+node.tId+consts.id.INPUT+"' treeNode"+consts.id.INPUT+" >");var inputObj=$$(node,consts.id.INPUT,setting);inputObj.attr("value",node[nameKey]),setting.edit.editNameSelectAll?tools.inputSelect(inputObj):tools.inputFocus(inputObj),inputObj.bind("blur",function(event){view.editNodeBlur||view.cancelCurEditNode(setting)}).bind("keydown",function(event){"13"==event.keyCode?(view.editNodeBlur=!0,view.cancelCurEditNode(setting)):"27"==event.keyCode&&view.cancelCurEditNode(setting,null,!0)}).bind("click",function(event){return!1}).bind("dblclick",function(event){return!1}),$$(node,consts.id.A,setting).addClass(consts.node.CURSELECTED_EDIT),root.curEditInput=inputObj,root.noSelection=!1,root.curEditNode=node}},moveNode:function(setting,targetNode,node,moveType,animateFlag,isSilent){var root=data.getRoot(setting),childKey=setting.data.key.children;if(targetNode!=node&&(!setting.data.keep.leaf||!targetNode||targetNode.isParent||moveType!=consts.move.TYPE_INNER)){var oldParentNode=node.parentTId?node.getParentNode():root,targetNodeIsRoot=null===targetNode||targetNode==root;targetNodeIsRoot&&null===targetNode&&(targetNode=root),targetNodeIsRoot&&(moveType=consts.move.TYPE_INNER);var targetObj,target_ulObj,targetParentNode=targetNode.parentTId?targetNode.getParentNode():root;if(moveType!=consts.move.TYPE_PREV&&moveType!=consts.move.TYPE_NEXT&&(moveType=consts.move.TYPE_INNER),moveType==consts.move.TYPE_INNER&&(targetNodeIsRoot?node.parentTId=null:(targetNode.isParent||(targetNode.isParent=!0,targetNode.open=!!targetNode.open,view.setNodeLineIcos(setting,targetNode)),node.parentTId=targetNode.tId)),targetNodeIsRoot)target_ulObj=targetObj=setting.treeObj;else{if(isSilent||moveType!=consts.move.TYPE_INNER?isSilent||view.expandCollapseNode(setting,targetNode.getParentNode(),!0,!1):view.expandCollapseNode(setting,targetNode,!0,!1),targetObj=$$(targetNode,setting),target_ulObj=$$(targetNode,consts.id.UL,setting),targetObj.get(0)&&!target_ulObj.get(0)){var ulstr=[];view.makeUlHtml(setting,targetNode,ulstr,""),targetObj.append(ulstr.join(""))}target_ulObj=$$(targetNode,consts.id.UL,setting)}var nodeDom=$$(node,setting);nodeDom.get(0)?targetObj.get(0)||nodeDom.remove():nodeDom=view.appendNodes(setting,node.level,[node],null,-1,!1,!0).join(""),target_ulObj.get(0)&&moveType==consts.move.TYPE_INNER?target_ulObj.append(nodeDom):targetObj.get(0)&&moveType==consts.move.TYPE_PREV?targetObj.before(nodeDom):targetObj.get(0)&&moveType==consts.move.TYPE_NEXT&&targetObj.after(nodeDom);var i,l,tmpSrcIndex=-1,tmpTargetIndex=0,oldNeighbor=null,newNeighbor=null,oldLevel=node.level;if(node.isFirstNode)tmpSrcIndex=0,oldParentNode[childKey].length>1&&((oldNeighbor=oldParentNode[childKey][1]).isFirstNode=!0);else if(node.isLastNode)tmpSrcIndex=oldParentNode[childKey].length-1,(oldNeighbor=oldParentNode[childKey][tmpSrcIndex-1]).isLastNode=!0;else for(i=0,l=oldParentNode[childKey].length;i<l;i++)if(oldParentNode[childKey][i].tId==node.tId){tmpSrcIndex=i;break}if(tmpSrcIndex>=0&&oldParentNode[childKey].splice(tmpSrcIndex,1),moveType!=consts.move.TYPE_INNER)for(i=0,l=targetParentNode[childKey].length;i<l;i++)targetParentNode[childKey][i].tId==targetNode.tId&&(tmpTargetIndex=i);if(moveType==consts.move.TYPE_INNER?(targetNode[childKey]||(targetNode[childKey]=new Array),targetNode[childKey].length>0&&((newNeighbor=targetNode[childKey][targetNode[childKey].length-1]).isLastNode=!1),targetNode[childKey].splice(targetNode[childKey].length,0,node),node.isLastNode=!0,node.isFirstNode=1==targetNode[childKey].length):targetNode.isFirstNode&&moveType==consts.move.TYPE_PREV?(targetParentNode[childKey].splice(tmpTargetIndex,0,node),(newNeighbor=targetNode).isFirstNode=!1,node.parentTId=targetNode.parentTId,node.isFirstNode=!0,node.isLastNode=!1):targetNode.isLastNode&&moveType==consts.move.TYPE_NEXT?(targetParentNode[childKey].splice(tmpTargetIndex+1,0,node),(newNeighbor=targetNode).isLastNode=!1,node.parentTId=targetNode.parentTId,node.isFirstNode=!1,node.isLastNode=!0):(moveType==consts.move.TYPE_PREV?targetParentNode[childKey].splice(tmpTargetIndex,0,node):targetParentNode[childKey].splice(tmpTargetIndex+1,0,node),node.parentTId=targetNode.parentTId,node.isFirstNode=!1,node.isLastNode=!1),data.fixPIdKeyValue(setting,node),data.setSonNodeLevel(setting,node.getParentNode(),node),view.setNodeLineIcos(setting,node),view.repairNodeLevelClass(setting,node,oldLevel),!setting.data.keep.parent&&oldParentNode[childKey].length<1){oldParentNode.isParent=!1,oldParentNode.open=!1;var tmp_ulObj=$$(oldParentNode,consts.id.UL,setting),tmp_switchObj=$$(oldParentNode,consts.id.SWITCH,setting),tmp_icoObj=$$(oldParentNode,consts.id.ICON,setting);view.replaceSwitchClass(oldParentNode,tmp_switchObj,consts.folder.DOCU),view.replaceIcoClass(oldParentNode,tmp_icoObj,consts.folder.DOCU),tmp_ulObj.css("display","none")}else oldNeighbor&&view.setNodeLineIcos(setting,oldNeighbor);newNeighbor&&view.setNodeLineIcos(setting,newNeighbor),setting.check&&setting.check.enable&&view.repairChkClass&&(view.repairChkClass(setting,oldParentNode),view.repairParentChkClassWithSelf(setting,oldParentNode),oldParentNode!=node.parent&&view.repairParentChkClassWithSelf(setting,node)),isSilent||view.expandCollapseParentNode(setting,node.getParentNode(),!0,animateFlag)}},removeEditBtn:function(setting,node){$$(node,consts.id.EDIT,setting).unbind().remove()},removeRemoveBtn:function(setting,node){$$(node,consts.id.REMOVE,setting).unbind().remove()},removeTreeDom:function(setting,node){node.isHover=!1,view.removeEditBtn(setting,node),view.removeRemoveBtn(setting,node),tools.apply(setting.view.removeHoverDom,[setting.treeId,node])},repairNodeLevelClass:function(setting,node,oldLevel){if(oldLevel!==node.level){var liObj=$$(node,setting),aObj=$$(node,consts.id.A,setting),ulObj=$$(node,consts.id.UL,setting),oldClass=consts.className.LEVEL+oldLevel,newClass=consts.className.LEVEL+node.level;liObj.removeClass(oldClass),liObj.addClass(newClass),aObj.removeClass(oldClass),aObj.addClass(newClass),ulObj.removeClass(oldClass),ulObj.addClass(newClass)}},selectNodes:function(setting,nodes){for(var i=0,l=nodes.length;i<l;i++)view.selectNode(setting,nodes[i],i>0)}},event:{},data:{setSonNodeLevel:function(setting,parentNode,node){if(node){var childKey=setting.data.key.children;if(node.level=parentNode?parentNode.level+1:0,node[childKey])for(var i=0,l=node[childKey].length;i<l;i++)node[childKey][i]&&data.setSonNodeLevel(setting,node,node[childKey][i])}}}};$.extend(!0,$.fn.zTree.consts,_consts),$.extend(!0,$.fn.zTree._z,_z);var zt=$.fn.zTree,tools=zt._z.tools,consts=zt.consts,view=zt._z.view,data=zt._z.data,$$=(zt._z.event,tools.$);data.exSetting({edit:{enable:!1,editNameSelectAll:!1,showRemoveBtn:!0,showRenameBtn:!0,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:!1,isCopy:!0,isMove:!0,prev:!0,next:!0,inner:!0,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDragMove:null,onDrop:null,onRename:null}}),data.addInitBind(function(setting){var o=setting.treeObj,c=consts.event;o.bind(c.RENAME,function(event,treeId,treeNode,isCancel){tools.apply(setting.callback.onRename,[event,treeId,treeNode,isCancel])}),o.bind(c.DRAG,function(event,srcEvent,treeId,treeNodes){tools.apply(setting.callback.onDrag,[srcEvent,treeId,treeNodes])}),o.bind(c.DRAGMOVE,function(event,srcEvent,treeId,treeNodes){tools.apply(setting.callback.onDragMove,[srcEvent,treeId,treeNodes])}),o.bind(c.DROP,function(event,srcEvent,treeId,treeNodes,targetNode,moveType,isCopy){tools.apply(setting.callback.onDrop,[srcEvent,treeId,treeNodes,targetNode,moveType,isCopy])})}),data.addInitUnBind(function(setting){var o=setting.treeObj,c=consts.event;o.unbind(c.RENAME),o.unbind(c.DRAG),o.unbind(c.DRAGMOVE),o.unbind(c.DROP)}),data.addInitCache(function(treeId){}),data.addInitNode(function(setting,level,n,parentNode,isFirstNode,isLastNode,openFlag){n&&(n.isHover=!1,n.editNameFlag=!1)}),data.addInitProxy(function(e){var target=e.target,setting=data.getSetting(e.data.treeId),relatedTarget=e.relatedTarget,tId="",node=null,nodeEventType="",nodeEventCallback=null,tmp=null;if(tools.eqs(e.type,"mouseover")?(tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]))&&(tId=tools.getNodeMainDom(tmp).id,nodeEventType="hoverOverNode"):tools.eqs(e.type,"mouseout")?(tmp=tools.getMDom(setting,relatedTarget,[{tagName:"a",attrName:"treeNode"+consts.id.A}]))||(tId="remove",nodeEventType="hoverOutNode"):tools.eqs(e.type,"mousedown")&&(tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]))&&(tId=tools.getNodeMainDom(tmp).id,nodeEventType="mousedownNode"),tId.length>0)switch(node=data.getNodeCache(setting,tId),nodeEventType){case"mousedownNode":nodeEventCallback=_handler.onMousedownNode;break;case"hoverOverNode":nodeEventCallback=_handler.onHoverOverNode;break;case"hoverOutNode":nodeEventCallback=_handler.onHoverOutNode}return{stop:!1,node:node,nodeEventType:nodeEventType,nodeEventCallback:nodeEventCallback,treeEventType:"",treeEventCallback:null}}),data.addInitRoot(function(setting){var r=data.getRoot(setting),rs=data.getRoots();r.curEditNode=null,r.curEditInput=null,r.curHoverNode=null,r.dragFlag=0,r.dragNodeShowBefore=[],r.dragMaskList=new Array,rs.showHoverDom=!0}),data.addZTreeTools(function(setting,zTreeTools){zTreeTools.cancelEditName=function(newName){data.getRoot(this.setting).curEditNode&&view.cancelCurEditNode(this.setting,newName||null,!0)},zTreeTools.copyNode=function(targetNode,node,moveType,isSilent){if(!node)return null;if(targetNode&&!targetNode.isParent&&this.setting.data.keep.leaf&&moveType===consts.move.TYPE_INNER)return null;var _this=this,newNode=tools.clone(node);if(targetNode||(targetNode=null,moveType=consts.move.TYPE_INNER),moveType==consts.move.TYPE_INNER){function copyCallback(){view.addNodes(_this.setting,targetNode,-1,[newNode],isSilent)}tools.canAsync(this.setting,targetNode)?view.asyncNode(this.setting,targetNode,isSilent,copyCallback):copyCallback()}else view.addNodes(this.setting,targetNode.parentNode,-1,[newNode],isSilent),view.moveNode(this.setting,targetNode,newNode,moveType,!1,isSilent);return newNode},zTreeTools.editName=function(node){node&&node.tId&&node===data.getNodeCache(this.setting,node.tId)&&(node.parentTId&&view.expandCollapseParentNode(this.setting,node.getParentNode(),!0),view.editNode(this.setting,node))},zTreeTools.moveNode=function(targetNode,node,moveType,isSilent){if(!node)return node;if(targetNode&&!targetNode.isParent&&this.setting.data.keep.leaf&&moveType===consts.move.TYPE_INNER)return null;if(targetNode&&(node.parentTId==targetNode.tId&&moveType==consts.move.TYPE_INNER||$$(node,this.setting).find("#"+targetNode.tId).length>0))return null;targetNode||(targetNode=null);var _this=this;function moveCallback(){view.moveNode(_this.setting,targetNode,node,moveType,!1,isSilent)}return tools.canAsync(this.setting,targetNode)&&moveType===consts.move.TYPE_INNER?view.asyncNode(this.setting,targetNode,isSilent,moveCallback):moveCallback(),node},zTreeTools.setEditable=function(editable){return this.setting.edit.enable=editable,this.refresh()}});var _cancelPreSelectedNode=view.cancelPreSelectedNode;view.cancelPreSelectedNode=function(setting,node){for(var list=data.getRoot(setting).curSelectedList,i=0,j=list.length;i<j&&(node&&node!==list[i]||(view.removeTreeDom(setting,list[i]),!node));i++);_cancelPreSelectedNode&&_cancelPreSelectedNode.apply(view,arguments)};var _createNodes=view.createNodes;view.createNodes=function(setting,level,nodes,parentNode,index){_createNodes&&_createNodes.apply(view,arguments),nodes&&view.repairParentChkClassWithSelf&&view.repairParentChkClassWithSelf(setting,parentNode)};var _makeNodeUrl=view.makeNodeUrl;view.makeNodeUrl=function(setting,node){return setting.edit.enable?null:_makeNodeUrl.apply(view,arguments)};var _removeNode=view.removeNode;view.removeNode=function(setting,node){var root=data.getRoot(setting);root.curEditNode===node&&(root.curEditNode=null),_removeNode&&_removeNode.apply(view,arguments)};var _selectNode=view.selectNode;view.selectNode=function(setting,node,addFlag){var root=data.getRoot(setting);return(!data.isSelectedNode(setting,node)||root.curEditNode!=node||!node.editNameFlag)&&(_selectNode&&_selectNode.apply(view,arguments),view.addHoverDom(setting,node),!0)};var _uCanDo=tools.uCanDo;tools.uCanDo=function(setting,e){var root=data.getRoot(setting);return!(!e||!(tools.eqs(e.type,"mouseover")||tools.eqs(e.type,"mouseout")||tools.eqs(e.type,"mousedown")||tools.eqs(e.type,"mouseup")))||(root.curEditNode&&(view.editNodeBlur=!1,root.curEditInput.focus()),!root.curEditNode&&(!_uCanDo||_uCanDo.apply(view,arguments)))}}(jQuery);