!function($){var options={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,offset:{top:0,left:"auto"},stroke:{color:"#FFF",width:1},label:{show:"auto",formatter:function(label,slice){return'<div style="font-size:x-small;text-align:center;padding:2px;color:'+slice.color+';">'+label+"<br/>"+Math.round(slice.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};$.plot.plugins.push({init:function(plot){var canvas=null,target=null,maxRadius=null,centerLeft=null,centerTop=null,total=0,redraw=!0,redrawAttempts=10,shrink=.95,legendWidth=0,processed=!1,highlights=[];function processDatapoints(plot,series,data,datapoints){processed||(processed=!0,canvas=plot.getCanvas(),target=$(canvas).parent(),options=plot.getOptions(),plot.setData(function(data){!function(data){for(var i=0;i<data.length;++i){var item=parseFloat(data[i].data[0][1]);item&&(total+=item)}}(data=function(data){for(var i=0;i<data.length;++i)"number"==typeof data[i].data?data[i].data=[[1,data[i].data]]:void 0!==data[i].data&&void 0!==data[i].data[0]||(void 0!==data[i].data&&void 0!==data[i].data.label&&(data[i].label=data[i].data.label),data[i].data=[[1,0]]);return data}(data));for(var combined=0,numCombined=0,color=options.series.pie.combine.color,newdata=[],i=0;i<data.length;++i)data[i].data[0][1]=parseFloat(data[i].data[0][1]),data[i].data[0][1]||(data[i].data[0][1]=0),data[i].data[0][1]/total<=options.series.pie.combine.threshold?(combined+=data[i].data[0][1],numCombined++,color||(color=data[i].color)):newdata.push({data:[[1,data[i].data[0][1]]],color:data[i].color,label:data[i].label,angle:data[i].data[0][1]*(2*Math.PI)/total,percent:data[i].data[0][1]/total*100});return numCombined>0&&newdata.push({data:[[1,combined]],color:color,label:options.series.pie.combine.label,angle:combined*(2*Math.PI)/total,percent:combined/total*100}),newdata}(plot.getData())))}function draw(plot,newCtx){if(target){ctx=newCtx,legendWidth=target.children().filter(".legend").children().width(),maxRadius=Math.min(canvas.width,canvas.height/options.series.pie.tilt)/2,centerTop=canvas.height/2+options.series.pie.offset.top,centerLeft=canvas.width/2,"auto"==options.series.pie.offset.left?options.legend.position.match("w")?centerLeft+=legendWidth/2:centerLeft-=legendWidth/2:centerLeft+=options.series.pie.offset.left,centerLeft<maxRadius?centerLeft=maxRadius:centerLeft>canvas.width-maxRadius&&(centerLeft=canvas.width-maxRadius);for(var slices=plot.getData(),attempts=0;redraw&&attempts<redrawAttempts;)redraw=!1,attempts>0&&(maxRadius*=shrink),attempts+=1,clear(),options.series.pie.tilt<=.8&&drawShadow(),drawPie();attempts>=redrawAttempts&&(clear(),target.prepend('<div class="error">Could not draw pie with labels contained inside canvas</div>')),plot.setSeries&&plot.insertLegend&&(plot.setSeries(slices),plot.insertLegend())}function clear(){ctx.clearRect(0,0,canvas.width,canvas.height),target.children().filter(".pieLabel, .pieLabelBackground").remove()}function drawShadow(){if(options.series.pie.radius>1)var radius=options.series.pie.radius;else radius=maxRadius*options.series.pie.radius;if(!(radius>=canvas.width/2-5||radius*options.series.pie.tilt>=canvas.height/2-15||radius<=10)){ctx.save(),ctx.translate(5,15),ctx.globalAlpha=.02,ctx.fillStyle="#000",ctx.translate(centerLeft,centerTop),ctx.scale(1,options.series.pie.tilt);for(var i=1;i<=10;i++)ctx.beginPath(),ctx.arc(0,0,radius,0,2*Math.PI,!1),ctx.fill(),radius-=i;ctx.restore()}}function drawPie(){if(startAngle=Math.PI*options.series.pie.startAngle,options.series.pie.radius>1)var radius=options.series.pie.radius;else radius=maxRadius*options.series.pie.radius;ctx.save(),ctx.translate(centerLeft,centerTop),ctx.scale(1,options.series.pie.tilt),ctx.save();for(var currentAngle=startAngle,i=0;i<slices.length;++i)slices[i].startAngle=currentAngle,drawSlice(slices[i].angle,slices[i].color,!0);for(ctx.restore(),ctx.save(),ctx.lineWidth=options.series.pie.stroke.width,currentAngle=startAngle,i=0;i<slices.length;++i)drawSlice(slices[i].angle,options.series.pie.stroke.color,!1);function drawSlice(angle,color,fill){angle<=0||(fill?ctx.fillStyle=color:(ctx.strokeStyle=color,ctx.lineJoin="round"),ctx.beginPath(),Math.abs(angle-2*Math.PI)>1e-9?ctx.moveTo(0,0):$.browser.msie&&(angle-=1e-4),ctx.arc(0,0,radius,currentAngle,currentAngle+angle,!1),ctx.closePath(),currentAngle+=angle,fill?ctx.fill():ctx.stroke())}ctx.restore(),drawDonutHole(ctx),options.series.pie.label.show&&function(){var currentAngle=startAngle;if(options.series.pie.label.radius>1)var radius=options.series.pie.label.radius;else var radius=maxRadius*options.series.pie.label.radius;for(var i=0;i<slices.length;++i)slices[i].percent>=100*options.series.pie.label.threshold&&drawLabel(slices[i],currentAngle,i),currentAngle+=slices[i].angle;function drawLabel(slice,startAngle,index){if(0!=slice.data[0][1]){var text,lf=options.legend.labelFormatter,plf=options.series.pie.label.formatter;text=lf?lf(slice.label,slice):slice.label,plf&&(text=plf(text,slice));var halfAngle=(startAngle+slice.angle+startAngle)/2,x=centerLeft+Math.round(Math.cos(halfAngle)*radius),y=centerTop+Math.round(Math.sin(halfAngle)*radius)*options.series.pie.tilt,html='<span class="pieLabel" id="pieLabel'+index+'" style="position:absolute;top:'+y+"px;left:"+x+'px;">'+text+"</span>";target.append(html);var label=target.children("#pieLabel"+index),labelTop=y-label.height()/2,labelLeft=x-label.width()/2;if(label.css("top",labelTop),label.css("left",labelLeft),(0-labelTop>0||0-labelLeft>0||canvas.height-(labelTop+label.height())<0||canvas.width-(labelLeft+label.width())<0)&&(redraw=!0),0!=options.series.pie.label.background.opacity){var c=options.series.pie.label.background.color;null==c&&(c=slice.color);var pos="top:"+labelTop+"px;left:"+labelLeft+"px;";$('<div class="pieLabelBackground" style="position:absolute;width:'+label.width()+"px;height:"+label.height()+"px;"+pos+"background-color:"+c+';"> </div>').insertBefore(label).css("opacity",options.series.pie.label.background.opacity)}}}}(),ctx.restore()}}function drawDonutHole(layer){options.series.pie.innerRadius>0&&(layer.save(),innerRadius=options.series.pie.innerRadius>1?options.series.pie.innerRadius:maxRadius*options.series.pie.innerRadius,layer.globalCompositeOperation="destination-out",layer.beginPath(),layer.fillStyle=options.series.pie.stroke.color,layer.arc(0,0,innerRadius,0,2*Math.PI,!1),layer.fill(),layer.closePath(),layer.restore(),layer.save(),layer.beginPath(),layer.strokeStyle=options.series.pie.stroke.color,layer.arc(0,0,innerRadius,0,2*Math.PI,!1),layer.stroke(),layer.closePath(),layer.restore())}function isPointInPoly(poly,pt){for(var c=!1,i=-1,l=poly.length,j=l-1;++i<l;j=i)(poly[i][1]<=pt[1]&&pt[1]<poly[j][1]||poly[j][1]<=pt[1]&&pt[1]<poly[i][1])&&pt[0]<(poly[j][0]-poly[i][0])*(pt[1]-poly[i][1])/(poly[j][1]-poly[i][1])+poly[i][0]&&(c=!c);return c}function onMouseMove(e){triggerClickHoverEvent("plothover",e)}function onClick(e){triggerClickHoverEvent("plotclick",e)}function triggerClickHoverEvent(eventname,e){var offset=plot.offset(),item=function(mouseX,mouseY){for(var slices=plot.getData(),options=plot.getOptions(),radius=options.series.pie.radius>1?options.series.pie.radius:maxRadius*options.series.pie.radius,i=0;i<slices.length;++i){var s=slices[i];if(s.pie.show){if(ctx.save(),ctx.beginPath(),ctx.moveTo(0,0),ctx.arc(0,0,radius,s.startAngle,s.startAngle+s.angle,!1),ctx.closePath(),x=mouseX-centerLeft,y=mouseY-centerTop,ctx.isPointInPath){if(ctx.isPointInPath(mouseX-centerLeft,mouseY-centerTop))return ctx.restore(),{datapoint:[s.percent,s.data],dataIndex:0,series:s,seriesIndex:i}}else if(p1X=radius*Math.cos(s.startAngle),p1Y=radius*Math.sin(s.startAngle),p2X=radius*Math.cos(s.startAngle+s.angle/4),p2Y=radius*Math.sin(s.startAngle+s.angle/4),p3X=radius*Math.cos(s.startAngle+s.angle/2),p3Y=radius*Math.sin(s.startAngle+s.angle/2),p4X=radius*Math.cos(s.startAngle+s.angle/1.5),p4Y=radius*Math.sin(s.startAngle+s.angle/1.5),p5X=radius*Math.cos(s.startAngle+s.angle),p5Y=radius*Math.sin(s.startAngle+s.angle),arrPoly=[[0,0],[p1X,p1Y],[p2X,p2Y],[p3X,p3Y],[p4X,p4Y],[p5X,p5Y]],arrPoint=[x,y],isPointInPoly(arrPoly,arrPoint))return ctx.restore(),{datapoint:[s.percent,s.data],dataIndex:0,series:s,seriesIndex:i};ctx.restore()}}return null}(parseInt(e.pageX-offset.left),parseInt(e.pageY-offset.top));if(options.grid.autoHighlight)for(var i=0;i<highlights.length;++i){var h=highlights[i];h.auto!=eventname||item&&h.series==item.series||unhighlight(h.series)}item&&function(s,auto){"number"==typeof s&&(s=series[s]);var i=indexOfHighlight(s);-1==i?(highlights.push({series:s,auto:auto}),plot.triggerRedrawOverlay()):auto||(highlights[i].auto=!1)}(item.series,eventname);var pos={pageX:e.pageX,pageY:e.pageY};target.trigger(eventname,[pos,item])}function unhighlight(s){null==s&&(highlights=[],plot.triggerRedrawOverlay()),"number"==typeof s&&(s=series[s]);var i=indexOfHighlight(s);-1!=i&&(highlights.splice(i,1),plot.triggerRedrawOverlay())}function indexOfHighlight(s){for(var i=0;i<highlights.length;++i)if(highlights[i].series==s)return i;return-1}function drawOverlay(plot,octx){var series,options=plot.getOptions(),radius=options.series.pie.radius>1?options.series.pie.radius:maxRadius*options.series.pie.radius;for(octx.save(),octx.translate(centerLeft,centerTop),octx.scale(1,options.series.pie.tilt),i=0;i<highlights.length;++i)(series=highlights[i].series).angle<0||(octx.fillStyle="rgba(255, 255, 255, "+options.series.pie.highlight.opacity+")",octx.beginPath(),Math.abs(series.angle-2*Math.PI)>1e-9&&octx.moveTo(0,0),octx.arc(0,0,radius,series.startAngle,series.startAngle+series.angle,!1),octx.closePath(),octx.fill());drawDonutHole(octx),octx.restore()}plot.hooks.processOptions.push(function(plot,options){options.series.pie.show&&(options.grid.show=!1,"auto"==options.series.pie.label.show&&(options.legend.show?options.series.pie.label.show=!1:options.series.pie.label.show=!0),"auto"==options.series.pie.radius&&(options.series.pie.label.show?options.series.pie.radius=.75:options.series.pie.radius=1),options.series.pie.tilt>1&&(options.series.pie.tilt=1),options.series.pie.tilt<0&&(options.series.pie.tilt=0),plot.hooks.processDatapoints.push(processDatapoints),plot.hooks.drawOverlay.push(drawOverlay),plot.hooks.draw.push(draw))}),plot.hooks.bindEvents.push(function(plot,eventHolder){var options=plot.getOptions();options.series.pie.show&&options.grid.hoverable&&eventHolder.unbind("mousemove").mousemove(onMouseMove),options.series.pie.show&&options.grid.clickable&&eventHolder.unbind("click").click(onClick)})},options:options,name:"pie",version:"1.0"})}(jQuery);